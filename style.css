/* ===== 基本 ===== */
:root{
  --bg:#0f1113;
  --bg-soft:#171a1d;
  --text:#eef0f1;
  --muted:#aeb6bd;
  --card:#15181b;
  --ink:#111315;

  /* 亮色主題（預設） */
  --l-bg:#ffffff;
  --l-bg-soft:#f5f7f8;
  --l-card:#ffffff;
  --l-text:#161819;
  --l-muted:#6b7280;

  --brand:#ff7f50;
  --btn-dark:#24272a;
  --ring:rgba(0,0,0,.08);
  --shadow:0 10px 30px rgba(0,0,0,.08);
  --radius:18px;

  /* z-index 統一控管 */
  --z-map: 10;
  --z-fab: 1000;
  --z-menu-backdrop: 1100;
  --z-menu: 1200;
  --z-dialog: 1300;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font:16px/1.55 ui-sans-serif, system-ui, -apple-system, "PingFang TC",
       "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
  color:var(--l-text);
  background:var(--l-bg);
}

/* 容器 */
.container{max-width:960px;margin:0 auto;padding:0 16px}

/* ===== 導覽列 ===== */
.nav{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 0;
}
.brand{display:flex;align-items:center;gap:10px;color:inherit;text-decoration:none}
.brand img{width:28px;height:28px;border-radius:8px}
.chipbar{display:flex;align-items:center;gap:12px}
.chip{
  display:flex;align-items:center;gap:6px;
  padding:8px 14px;border-radius:999px;background:#111418;color:#fff;
  box-shadow:var(--shadow);
}
.chip .who{max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.chip .sep{opacity:.35}

.menu-toggle{
  border:0;background:#1c1f22;color:#fff;border-radius:14px;padding:10px 12px;
}
.menu-ico{display:inline-block;width:20px;height:2px;background:#fff;position:relative}
.menu-ico::before,.menu-ico::after{content:"";position:absolute;left:0;width:20px;height:2px;background:#fff}
.menu-ico::before{top:-6px}.menu-ico::after{top:6px}

/* ===== 共用元件 ===== */
.btn{
  display:inline-flex;align-items:center;justify-content:center;
  padding:10px 16px;border-radius:16px;border:0;background:var(--brand);
  color:#111;font-weight:700;cursor:pointer;box-shadow:var(--shadow)
}
.btn.secondary{background:#22272b;color:#fff}
.btn.compact{padding:6px 10px}
.inline{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.space-between{justify-content:space-between}
.mt-0{margin-top:0}.mt-1{margin-top:.75rem}.mt-2{margin-top:1.25rem}
.fullrow{width:100%}
.flex-1{flex:1}

.pill{
  display:inline-block;background:#fdd9cc;color:#111;padding:8px 14px;border-radius:999px;
  font-weight:800;letter-spacing:.5px
}

.section-caption{color:#9aa3ab;margin:8px 0 10px}

/* 卡片 */
.card{
  background:var(--l-card); color:var(--l-text);
  border-radius:var(--radius); padding:18px; box-shadow:var(--shadow);
}
.hero{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;align-items:center}
.hero-logo{width:100%;border-radius:22px;box-shadow:var(--shadow)}
.hero-title{font-size:28px;letter-spacing:1px;margin:.4rem 0 0}
.muted{color:var(--l-muted)}

/* 表單 */
.input{
  width:100%;padding:12px 14px;border-radius:14px;border:1px solid #e5e7eb;
  background:#fff;color:#111;outline:none;box-shadow:inset 0 1px 0 rgba(0,0,0,.03);
}
.input:focus{border-color:#cbd5e1;box-shadow:0 0 0 4px rgba(2,132,199,.12)}
label{display:block;gap:6px;color:var(--l-muted);font-weight:600}
label>.input{margin-top:6px}

.grid{display:grid;gap:12px}
.g-2{grid-template-columns:1fr 1fr}
.g-3{grid-template-columns:repeat(3,1fr)}
.gcol-2{grid-column:span 2}
@media (max-width:640px){
  .hero{grid-template-columns:1fr}
  .g-2,.g-3{grid-template-columns:1fr}
  .gcol-2{grid-column:span 1}
}

/* 產品橫捲 */
.hwrap{position:relative}
.hscroll{display:grid;grid-auto-flow:column;grid-auto-columns:80%;gap:16px;overflow-x:auto;scroll-snap-type:x mandatory}
.hscroll>.card{scroll-snap-align:start}
.hbtn{position:absolute;top:50%;transform:translateY(-50%);width:36px;height:36px;border-radius:999px;border:0;background:#111;color:#fff;opacity:.85}
.hbtn.prev{left:-6px}.hbtn.next{right:-6px}
.product .prod-img{width:100%;border-radius:16px}

/* 表格 */
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid #eef2f4;text-align:left}

/* 主子卡 */
.p-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.p-card{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;background:#f8fafb;border-radius:16px;padding:10px}
.p-avatar{width:64px;height:64px;object-fit:cover;border-radius:14px}
.p-meta{color:#1f2937}

/* 照片牆 */
#wall{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.tile{aspect-ratio:1/1;border-radius:12px;overflow:hidden;background:#f1f5f9;cursor:pointer}
.tile img{width:100%;height:100%;object-fit:cover}

/* 聊天 */
.chatbox{height:280px;border-radius:16px;background:#f8fafc;padding:10px;overflow:auto}
.msg{padding:8px 10px;border-radius:14px;margin:6px 0;max-width:75%}
.msg.me{background:#fde1d4;margin-left:auto}
.msg.other{background:#e5e7eb}

/* 影片 */
.video{width:100%;border-radius:14px}

/* 地圖 */
.mapbox{height:360px;border-radius:16px;overflow:hidden;position:relative}
.leaflet-container{height:100%;z-index:var(--z-map)}          /* ⬅ 降低地圖層級 */
.leaflet-pane,.leaflet-top,.leaflet-bottom{z-index:var(--z-map)}

/* Footer */
.footer{color:#9aa3ab;padding:30px 0 60px}

/* ===== Dialog ===== */
dialog{border:0;padding:0;background:transparent;z-index:var(--z-dialog)}
.auth-outer{padding:20px;display:grid;place-items:center}
.auth-card{
  width:min(680px,92vw);background:#fff;color:#111;border-radius:22px;
  padding:20px;box-shadow:0 20px 60px rgba(0,0,0,.25)
}
.auth-title{margin:0 0 12px}
.pm-img{width:100%;border-radius:16px;background:#000}
.pm-comments .c{padding:6px 0;border-bottom:1px dashed #e5e7eb}

/* 使 dialog 開啟時，後景半透明 */
dialog::backdrop{background:rgba(0,0,0,.45)}

/* ===== 社群登入（新版） ===== */
.social-grid{
  display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-top:14px
}
@media (min-width:480px){ .social-grid{grid-template-columns:repeat(4,1fr)} }
.provider{width:100%;padding:14px 8px;background:#23282c;color:#fff;font-weight:800}

/* ===== 漂浮鈕（層級最高） ===== */
.fab{position:fixed;right:18px;bottom:18px;z-index:var(--z-fab)}
.fab-btn{width:88px;height:88px;border-radius:999px;background:linear-gradient(180deg,#ff9a6a,#ff7f50);color:#111;font-weight:900;border:0;box-shadow:0 14px 36px rgba(0,0,0,.25)}

/* ===== 手機抽屜選單（層級高於地圖） ===== */
.menu{
  position:fixed;inset:0 30% 0 0;transform:translateX(-100%);
  background:#fff;z-index:var(--z-menu);padding:18px;overflow:auto;
  box-shadow:20px 0 50px rgba(0,0,0,.1);border-radius:0 22px 22px 0
}
.menu a{
  display:block;background:#f0f4f6;border-radius:16px;padding:16px 14px;margin:10px 0;
  text-decoration:none;color:#111;font-weight:800;
}
.menu.open{transform:none;transition:transform .24s ease}
.menu-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;z-index:var(--z-menu-backdrop)
}
.menu-backdrop.show{opacity:1;pointer-events:auto}

/* ===== 深色主題支援（可選） ===== */
/* 如果之後要做自動判斷，可加 prefers-color-scheme: dark 的變體 */
/* === Kiosk Map 強化 === */
#map.mapbox { 
  display:block;
  height:360px;
  min-height:360px;
}

/* 讓地圖不會蓋住右下 Top 與抽屜選單 */
.leaflet-container { z-index: 1; }   /* 地圖本身層級低 */
.fab { z-index: 1000; }               /* Top/FAB 蓋在地圖上 */
.menu, .menu-backdrop { z-index: 2000; } /* 抽屜與遮罩最上層 */

/* === Header / Chipbar 強化：穩定高度、對齊、溢位省略 === */
.nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: .75rem;
}

.chipbar {
  display: flex;
  align-items: center;
  gap: .5rem;
  min-width: 0; /* 允許內部做 ellipsis */
}

/* 晶片外框：固定高度、避免被內容撐高 */
.chip {
  display: flex;
  align-items: center;
  gap: .25rem;
  height: 40px;
  padding: 0 .6rem;
  border-radius: 999px;
  background: rgba(0,0,0,.06);
  backdrop-filter: saturate(140%) blur(4px);
  min-width: 0;
  max-width: min(66vw, 340px); /* 行動裝置不超過 2/3 螢幕寬 */
}

/* 帳號文字：單行省略，避免拉爆版面 */
#whoText.who {
  display: inline-block;
  max-width: calc(100% - 88px); /* 預留分隔線與按鈕空間 */
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  line-height: 1; /* 垂直置中更穩定 */
}

/* 分隔線窄一點，節省空間 */
.chip .sep { opacity: .55; margin: 0 .25rem; }

/* 登入/登出按鈕：橫向文字、不換行、緊湊 */
.btn.compact,
.chip .btn {
  white-space: nowrap;
  padding: .38rem .6rem;
  line-height: 1;
  height: 28px;
  display: inline-flex;
  align-items: center;
}

/* 超窄螢幕保護（≤360px）：再緊一點 */
@media (max-width: 360px) {
  .chip { max-width: 75vw; padding: 0 .5rem; }
  #whoText.who { max-width: calc(100% - 80px); font-size: .92rem; }
  .btn.compact, .chip .btn { padding: .34rem .52rem; height: 26px; }
}

/* === 漢堡按鈕與 icon 垂直置中 === */
.menu-toggle {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  display: grid;              /* 中心對齊 */
  place-items: center;
  padding: 0;
}

.menu-ico {
  position: relative;
  width: 20px;
  height: 16px;               /* 三線的整體高度 */
}
.menu-ico::before,
.menu-ico::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  height: 2px;
  background: currentColor;
  border-radius: 2px;
}
/* 上下兩線 */
.menu-ico::before { top: 0; }
.menu-ico::after  { bottom: 0; }
/* 中線用 box-shadow 疊一條，確保正中 */
.menu-ico { box-shadow: 0 7px 0 0 currentColor inset; }

/* === 抽屜層級（沿用你 v13 設定，保留在這裡以免被其他樣式覆蓋） === */
#menu { position: fixed; z-index: 10010; }
#menuBackdrop { position: fixed; z-index: 10000; }
.fab { z-index: 9990; }
#menu a { pointer-events: auto; }
