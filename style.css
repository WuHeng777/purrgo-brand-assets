V14 style.css

/* ===== 基本 ===== */
:root{
  --bg:#0f1113;
  --bg-soft:#171a1d;
  --text:#eef0f1;
  --muted:#aeb6bd;
  --card:#15181b;
  --ink:#111315;

  /* 亮色主題（預設） */
  --l-bg:#ffffff;
  --l-bg-soft:#f5f7f8;
  --l-card:#ffffff;
  --l-text:#161819;
  --l-muted:#6b7280;

  --brand:#ff7f50;
  --btn-dark:#24272a;
  --ring:rgba(0,0,0,.08);
  --shadow:0 10px 30px rgba(0,0,0,.08);
  --radius:18px;

  /* z-index 統一控管 */
  --z-map: 10;
  --z-fab: 1000;
  --z-menu-backdrop: 1100;
  --z-menu: 1200;
  --z-dialog: 1300;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font:16px/1.55 ui-sans-serif, system-ui, -apple-system, "PingFang TC",
       "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
  color:var(--l-text);
  background:var(--l-bg);
}

/* 容器 */
.container{max-width:960px;margin:0 auto;padding:0 16px}

/* ===== 導覽列 ===== */
.nav{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 0;
}
.brand{display:flex;align-items:center;gap:10px;color:inherit;text-decoration:none}
.brand img{width:28px;height:28px;border-radius:8px}
.chipbar{display:flex;align-items:center;gap:12px}
.chip{
  display:flex;align-items:center;gap:6px;
  padding:8px 14px;border-radius:999px;background:#111418;color:#fff;
  box-shadow:var(--shadow);
}
.chip .who{max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.chip .sep{opacity:.35}

.menu-toggle{
  border:0;background:#1c1f22;color:#fff;border-radius:14px;padding:10px 12px;
}
.menu-ico{display:inline-block;width:20px;height:2px;background:#fff;position:relative}
.menu-ico::before,.menu-ico::after{content:"";position:absolute;left:0;width:20px;height:2px;background:#fff}
.menu-ico::before{top:-6px}.menu-ico::after{top:6px}

/* ===== 共用元件 ===== */
.btn{
  display:inline-flex;align-items:center;justify-content:center;
  padding:10px 16px;border-radius:16px;border:0;background:var(--brand);
  color:#111;font-weight:700;cursor:pointer;box-shadow:var(--shadow)
}
.btn.secondary{background:#22272b;color:#fff}
.btn.compact{padding:6px 10px}
.inline{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.space-between{justify-content:space-between}
.mt-0{margin-top:0}.mt-1{margin-top:.75rem}.mt-2{margin-top:1.25rem}
.fullrow{width:100%}
.flex-1{flex:1}

.pill{
  display:inline-block;background:#fdd9cc;color:#111;padding:8px 14px;border-radius:999px;
  font-weight:800;letter-spacing:.5px
}

.section-caption{color:#9aa3ab;margin:8px 0 10px}

/* 卡片 */
.card{
  background:var(--l-card); color:var(--l-text);
  border-radius:var(--radius); padding:18px; box-shadow:var(--shadow);
}
.hero{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;align-items:center}
.hero-logo{width:100%;border-radius:22px;box-shadow:var(--shadow)}
.hero-title{font-size:28px;letter-spacing:1px;margin:.4rem 0 0}
.muted{color:var(--l-muted)}

/* 表單 */
.input{
  width:100%;padding:12px 14px;border-radius:14px;border:1px solid #e5e7eb;
  background:#fff;color:#111;outline:none;box-shadow:inset 0 1px 0 rgba(0,0,0,.03);
}
.input:focus{border-color:#cbd5e1;box-shadow:0 0 0 4px rgba(2,132,199,.12)}
label{display:block;gap:6px;color:var(--l-muted);font-weight:600}
label>.input{margin-top:6px}

.grid{display:grid;gap:12px}
.g-2{grid-template-columns:1fr 1fr}
.g-3{grid-template-columns:repeat(3,1fr)}
.gcol-2{grid-column:span 2}
@media (max-width:640px){
  .hero{grid-template-columns:1fr}
  .g-2,.g-3{grid-template-columns:1fr}
  .gcol-2{grid-column:span 1}
}

/* 產品橫捲 */
.hwrap{position:relative}
.hscroll{display:grid;grid-auto-flow:column;grid-auto-columns:80%;gap:16px;overflow-x:auto;scroll-snap-type:x mandatory}
.hscroll>.card{scroll-snap-align:start}
.hbtn{position:absolute;top:50%;transform:translateY(-50%);width:36px;height:36px;border-radius:999px;border:0;background:#111;color:#fff;opacity:.85}
.hbtn.prev{left:-6px}.hbtn.next{right:-6px}
.product .prod-img{width:100%;border-radius:16px}

/* 表格 */
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid #eef2f4;text-align:left}

/* 主子卡 */
.p-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.p-card{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;background:#f8fafb;border-radius:16px;padding:10px}
.p-avatar{width:64px;height:64px;object-fit:cover;border-radius:14px}
.p-meta{color:#1f2937}

/* 照片牆 */
#wall{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.tile{aspect-ratio:1/1;border-radius:12px;overflow:hidden;background:#f1f5f9;cursor:pointer}
.tile img{width:100%;height:100%;object-fit:cover}

/* 聊天 */
.chatbox{height:280px;border-radius:16px;background:#f8fafc;padding:10px;overflow:auto}
.msg{padding:8px 10px;border-radius:14px;margin:6px 0;max-width:75%}
.msg.me{background:#fde1d4;margin-left:auto}
.msg.other{background:#e5e7eb}

/* 影片 */
.video{width:100%;border-radius:14px}

/* 地圖 */
.mapbox{height:360px;border-radius:16px;overflow:hidden;position:relative}
.leaflet-container{height:100%;z-index:var(--z-map)}          /* ⬅ 降低地圖層級 */
.leaflet-pane,.leaflet-top,.leaflet-bottom{z-index:var(--z-map)}

/* Footer */
.footer{color:#9aa3ab;padding:30px 0 60px}

/* ===== Dialog ===== */
dialog{border:0;padding:0;background:transparent;z-index:var(--z-dialog)}
.auth-outer{padding:20px;display:grid;place-items:center}
.auth-card{
  width:min(680px,92vw);background:#fff;color:#111;border-radius:22px;
  padding:20px;box-shadow:0 20px 60px rgba(0,0,0,.25)
}
.auth-title{margin:0 0 12px}
.pm-img{width:100%;border-radius:16px;background:#000}
.pm-comments .c{padding:6px 0;border-bottom:1px dashed #e5e7eb}

/* 使 dialog 開啟時，後景半透明 */
dialog::backdrop{background:rgba(0,0,0,.45)}

/* ===== 社群登入（新版） ===== */
.social-grid{
  display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-top:14px
}
@media (min-width:480px){ .social-grid{grid-template-columns:repeat(4,1fr)} }
.provider{width:100%;padding:14px 8px;background:#23282c;color:#fff;font-weight:800}

/* ===== 漂浮鈕（層級最高） ===== */
.fab{position:fixed;right:18px;bottom:18px;z-index:var(--z-fab)}
.fab-btn{width:88px;height:88px;border-radius:999px;background:linear-gradient(180deg,#ff9a6a,#ff7f50);color:#111;font-weight:900;border:0;box-shadow:0 14px 36px rgba(0,0,0,.25)}

/* ===== 手機抽屜選單（層級高於地圖） ===== */
.menu{
  position:fixed;inset:0 30% 0 0;transform:translateX(-100%);
  background:#fff;z-index:var(--z-menu);padding:18px;overflow:auto;
  box-shadow:20px 0 50px rgba(0,0,0,.1);border-radius:0 22px 22px 0
}
.menu a{
  display:block;background:#f0f4f6;border-radius:16px;padding:16px 14px;margin:10px 0;
  text-decoration:none;color:#111;font-weight:800;
}
.menu.open{transform:none;transition:transform .24s ease}
.menu-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;z-index:var(--z-menu-backdrop)
}
.menu-backdrop.show{opacity:1;pointer-events:auto}

/* ===== 深色主題支援（可選） ===== */
/* 如果之後要做自動判斷，可加 prefers-color-scheme: dark 的變體 */
/* === Kiosk Map 強化 === */
#map.mapbox { 
  display:block;
  height:360px;
  min-height:360px;
}

/* 讓地圖不會蓋住右下 Top 與抽屜選單 */
.leaflet-container { z-index: 1; }   /* 地圖本身層級低 */
.fab { z-index: 1000; }               /* Top/FAB 蓋在地圖上 */
.menu, .menu-backdrop { z-index: 2000; } /* 抽屜與遮罩最上層 */

/* === v13.1 熱修：晶片更輕、更穩、更不會爆版 === */
.nav{display:flex;align-items:center;justify-content:space-between;gap:.75rem}
.chipbar{display:flex;align-items:center;gap:.5rem;min-width:0}

/* 晶片：移除強烈的 blur/陰影，尺寸更精簡 */
.chip{
  display:flex;align-items:center;gap:.4rem;
  height:34px;padding:0 .6rem;border-radius:999px;
  background:rgba(255,255,255,.88); /* 白底微透明，乾淨 */
  border:1px solid rgba(0,0,0,.06);
  box-shadow:0 2px 6px rgba(0,0,0,.04);
  min-width:0; /* 允許內部做 ellipsis */
}

/* 帳號文字：佔滿可用空間，單行省略 */
#whoText.who{
  flex:1 1 auto;min-width:0;
  overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
  line-height:1;
}

/* 分隔線更小一點 */
.chip .sep{opacity:.6;margin:0 .25rem}

/* 登入/登出：橫向、不換行、固定高度 */
.chip .btn,.btn.compact{
  flex:0 0 auto;display:inline-flex;align-items:center;
  height:26px;line-height:1;padding:.34rem .56rem;white-space:nowrap;
}

/* 超窄螢幕保護（≤360px） */
@media (max-width:360px){
  .chip{height:32px;padding:0 .5rem}
  .chip .btn,.btn.compact{height:24px;padding:.3rem .5rem}
}

/* 抽屜層級 */
#menu{position:fixed;z-index:10010}
#menuBackdrop{position:fixed;z-index:10000}
.fab{z-index:9990}
#menu a{pointer-events:auto}

/* 晶片：濃霧玻璃 + 更清楚的字色 */
.chip{
  display:flex;align-items:center;gap:.4rem;
  height:36px;padding:0 .8rem;border-radius:999px;
  background:rgba(255,255,255,.55);
  backdrop-filter:blur(12px) saturate(160%);
  -webkit-backdrop-filter:blur(12px) saturate(160%);
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  min-width:0;
}
#whoText.who{
  flex:1 1 auto;min-width:0;
  font-weight:600;                 /* 比之前再重一點 */
  color:rgba(0,0,0,.88);           /* 比之前更深一點 */
  overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
}
.chip .sep{opacity:.5;margin:0 .25rem}
.chip .btn,.btn.compact{
  flex:0 0 auto;display:inline-flex;align-items:center;
  height:28px;line-height:1;padding:.36rem .7rem;white-space:nowrap;font-weight:500;
}
/* 晶片內的身分字樣 */
.chip .who{
  color: rgba(0,0,0,.86);
  font-weight: 600;
}
/* 漢堡本體：深色圓角、置中 */
.menu-toggle{
  width:44px;height:44px;border:none;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  padding:0;cursor:pointer;background:rgba(0,0,0,.92);
}

/* 3 條線（不靠偽元素） */
.menu-ico{
  display:block;width:22px;height:16px;
  background:
    linear-gradient(#fff, #fff) left top/100% 2px no-repeat,
    linear-gradient(#fff, #fff) left center/100% 2px no-repeat,
    linear-gradient(#fff, #fff) left bottom/100% 2px no-repeat;
}

/* 若有舊樣式殘留，確保這兩條規則優先（可放在檔尾） */
.menu-ico::before, .menu-ico::after { content: none !important; }

/* === 固定品牌名稱不換行，過長省略 === */
.brand span {
  white-space: nowrap;        /* 不允許換行 */
  overflow: hidden;           /* 超出隱藏 */
  text-overflow: ellipsis;    /* 超出時顯示 … */
  max-width: 140px;           /* 視需要可調，建議 120~160px */
  display: inline-block;
  vertical-align: middle;
}

/* ====== 喵力聯盟（Alliance）增補樣式 —— 貼在 style.css 檔尾 ====== */

/* 區塊標題對齊與間距 */
#page-alliance .section-caption { color:#9aa3ab; margin:8px 0 10px }
#page-alliance h3 { margin:.25rem 0 .5rem }
#page-alliance h4 { margin:.25rem 0 .25rem; font-size:1rem }

/* 概覽：等級/XP 進度條 */
#allyBarWrap{
  height:12px; background:#eef2f4; border-radius:999px; overflow:hidden;
  box-shadow: inset 0 1px 2px rgba(0,0,0,.06);
  max-width:460px;
}
#allyBar{
  height:100%; width:0%;
  background: linear-gradient(90deg,#ff9a6a,#ff7f50);
  transition: width .4s ease;
  border-radius:999px;
}

/* 卸任投票條 */
#voteBarWrap{
  height:12px; background:#eef2f4; border-radius:999px; overflow:hidden;
  box-shadow: inset 0 1px 2px rgba(0,0,0,.06);
}
#voteBar{
  height:100%; width:0%;
  background:#10b981;              /* 同意（綠） */
  transition: width .3s ease;
}

/* 概覽右上角數字排版 */
#page-alliance .align-right{ text-align:right }
#page-alliance .align-right .muted b{ color:#111 }

/* 祖譜容器：讓卡片整齊排列、可換行 */
#geneLeader,
#geneOfficers,
#geneDiamond,#geneGold,#geneSilver,#geneBronze{
  display:flex; flex-wrap:wrap; gap:10px;
}

/* 小尺寸卡片的共同樣式（覆蓋預設 card 一些間距） */
#page-alliance .card{
  background:var(--l-card);
  color:var(--l-text);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
#page-alliance .card h3,
#page-alliance .card h4 { color:var(--l-text) }

/* 成員卡：內文排版微調（配合 JS 動態建立的 inline grid 結構） */
#page-alliance .card img{
  border-radius:12px; object-fit:cover;
  box-shadow: 0 1px 2px rgba(0,0,0,.08);
}
#page-alliance .card .muted{ color:var(--l-muted) }

/* 頭貼加外框（依階級上色） */
#geneLeader   img{ box-shadow:0 0 0 3px #111 inset, 0 1px 2px rgba(0,0,0,.1) } /* 盟主：黑框 */
#geneOfficers img{ box-shadow:0 0 0 3px #ffb86b inset, 0 1px 2px rgba(0,0,0,.1) } /* 官職：琥珀 */
#geneDiamond  img{ box-shadow:0 0 0 3px #60a5fa inset, 0 1px 2px rgba(0,0,0,.1) } /* 鑽石：藍 */
#geneGold     img{ box-shadow:0 0 0 3px #fbbf24 inset, 0 1px 2px rgba(0,0,0,.1) } /* 黃金 */
#geneSilver   img{ box-shadow:0 0 0 3px #cbd5e1 inset, 0 1px 2px rgba(0,0,0,.1) } /* 白銀 */
#geneBronze   img{ box-shadow:0 0 0 3px #d1a37a inset, 0 1px 2px rgba(0,0,0,.1) } /* 青銅 */

/* 祖譜標題的色票 */
#page-alliance h4.mt-0{
  display:inline-flex; align-items:center; gap:.5ch;
}
#page-alliance h4.mt-0::before{
  content:""; display:inline-block; width:10px; height:10px; border-radius:2px; opacity:.9;
}
#geneDiamond ~ h4.mt-0::before { background:#60a5fa }   /* 若直接接在標題後可用，但本頁容器分開，改個別指定： */
#page-alliance h4:has(+ #geneDiamond)::before { background:#60a5fa }
#page-alliance h4:has(+ #geneGold)::before    { background:#fbbf24 }
#page-alliance h4:has(+ #geneSilver)::before  { background:#cbd5e1 }
#page-alliance h4:has(+ #geneBronze)::before  { background:#d1a37a }

/* 投票區：提示字更淡、按鈕間距 */
#voteHint{ color:var(--l-muted) }
#page-alliance #btnStartVote,
#page-alliance #btnVoteYes,
#page-alliance #btnVoteNo{ min-width:112px }

/* Officers 區的卡片排版，讓一排最多 5 張時也不擁擠 */
#geneOfficers{ gap:12px }
#geneOfficers > .card{ min-width:230px }

/* 人數/容量數字在手機也不擠 */
@media (max-width:640px){
  #page-alliance .align-right{ text-align:left }
  #allyBarWrap{ max-width:100% }
}

/* 小螢幕祖譜：每張卡片全寬排列較好閱讀 */
@media (max-width:480px){
  #geneLeader > .card,
  #geneOfficers > .card,
  #geneDiamond > .card,
  #geneGold > .card,
  #geneSilver > .card,
  #geneBronze > .card{
    width:100%;
  }
}

/* 投票進度數字排版一致 */
#voteYes, #votePct, #voteNeed{ font-variant-numeric: tabular-nums; }

/* 表單下拉在卡片內縮小一點（盟主調整職級用） */
#page-alliance select.input{
  padding:8px 10px; height:36px; border-radius:12px;
}

/* =========================================================
   喵力聯盟（Miao Alliance）— v13 Add-on Styles
   貼在 style.css 檔尾即可
   ========================================================= */

/* —— 漢堡三條線：穩固版（避免被舊規則覆蓋） —— */
button.menu-toggle{
  width:44px;height:44px;border:none;border-radius:12px;
  display:flex;align-items:center;justify-content:center;padding:0;
  background:rgba(0,0,0,.92); color:#fff; cursor:pointer;
}
button.menu-toggle > .menu-ico{
  display:block; width:22px; height:16px; position:relative;
  background:
    linear-gradient(#fff,#fff) left top/100% 2px no-repeat,
    linear-gradient(#fff,#fff) left center/100% 2px no-repeat,
    linear-gradient(#fff,#fff) left bottom/100% 2px no-repeat;
}
/* 關閉舊的偽元素畫線，避免疊出第4條 */
.menu-ico::before,
.menu-ico::after{ content:none !important; }

/* —— 品牌名稱過長時不換行（若你檔內已有，這段等於保險覆寫） —— */
.brand span{
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  max-width:140px; display:inline-block; vertical-align:middle;
}

/* =========================================================
   喵力聯盟：等級條 / 投票條 / 人事祖譜元件
   ========================================================= */

/* XP 進度條（聯盟等級） */
#allyBarWrap{
  height:10px; border-radius:999px; background:#eef2f4; overflow:hidden;
}
#allyBar{
  height:100%; width:0%;
  background:linear-gradient(90deg,#ff9a6a,#ff7f50);
  transition:width .35s ease;
}

/* 卸任投票條 */
#voteBarWrap{
  height:8px; border-radius:999px; background:#f1f5f9; overflow:hidden;
}
#voteBar{
  height:100%; width:0%; background:#111; transition:width .25s ease;
}

/* 祖譜列排 */
.gene-row{
  display:flex; flex-wrap:wrap; gap:10px;
}

/* 成員卡片（頭貼 + 名稱 + 戰力 + 階級 Badge） */
.gene-card{
  display:flex; align-items:center; gap:10px;
  min-width:220px; padding:10px 12px;
  background:#f8fafb; border:1px solid #eef2f4;
  border-radius:14px; box-shadow:0 1px 0 rgba(0,0,0,.02);
}
.gene-card:hover{ box-shadow:0 6px 18px rgba(0,0,0,.06); transform:translateY(-1px); transition:.2s ease; }

.gene-ava{
  width:36px; height:36px; border-radius:50%; object-fit:cover; background:#e5e7eb;
  box-shadow:inset 0 0 0 1px rgba(0,0,0,.05);
}
.gene-meta{ display:flex; flex-direction:column; line-height:1.2; }
.gene-meta b{ font-weight:800; }
.gene-meta .tiny{ color:#64748b; }

.badge{
  margin-left:auto;
  display:inline-block; font-size:12px; font-weight:800; letter-spacing:.25px;
  padding:2px 8px; border-radius:999px; color:#111; background:#fde1d4;
  box-shadow:inset 0 -1px 0 rgba(0,0,0,.06);
}

/* 小工具字型與對齊 */
.align-right{ text-align:right; }
.tiny{ font-size:12px; opacity:.75; }
.mono{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
               "Liberation Mono", "Courier New", monospace;
}

/* 手機友善：卡片收闔間距更緊湊 */
@media (max-width:480px){
  .gene-card{ min-width:unset; width:100%; }
}

/* =========================================================
   舊公會與新聯盟的互通視覺微調（輕量）
   ========================================================= */

/* 卡片標題與說明行距一致 */
.section-head .section-sub{ color:var(--l-muted); margin:.25rem 0 0; }

/* 投票區與提示的距離更舒服 */
#voteBox{ padding:.25rem 0 .5rem; }
#voteHint{ color:#64748b; }

/* 成員選單與角色選單在窄螢幕排版更穩定 */
#allyMemberSelect, #allyRoleSelect{ min-width:0; }

/* 表格列在深色/亮色主題下邊界微弱，避免太重 */
.table th, .table td{ border-bottom:1px solid #eef2f4; }

/* 晶片/導航保留你原本的霧面感（若先前段落已有同名規則，此段為兼容覆寫） */
.chip{
  background:rgba(255,255,255,.55);
  backdrop-filter:blur(12px) saturate(160%);
  -webkit-backdrop-filter:blur(12px) saturate(160%);
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
#whoText.who{ color:rgba(0,0,0,.88); font-weight:600; }

/* —— 完 —— */
