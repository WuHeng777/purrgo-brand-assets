<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PurrGo 喵來速 Demo</title>

  <!-- ===============================
       內嵌 CSS（可之後拆到 style.css）
       =============================== -->
  <style>
  :root{
    --bg:#0f1011; --bg-2:#151618; --card:#131416; --text:#eaeaea; --muted:#9aa0a6;
    --brand:#ff7f50; --chip:#ffe0d3; --chip-text:#2b2b2b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Inter,system-ui,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;line-height:1.6}
  a{color:inherit;text-decoration:none}
  img{max-width:100%;display:block}
  .container{max-width:1120px;margin:0 auto;padding:0 16px}
  .mt-0{margin-top:0}.mt-1{margin-top:.5rem}.mt-2{margin-top:1rem}
  .muted{color:var(--muted)}

  /* ===== 頂部列（品牌＋訪客/登入＋漢堡） ===== */
  header{position:sticky;top:0;z-index:1000;background:rgba(15,16,17,.8);backdrop-filter:saturate(1.2) blur(8px)}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800}
  .brand img{width:28px;height:28px;border-radius:8px;object-fit:cover}
  .auth{display:flex;align-items:center;gap:8px;padding:6px 12px;border-radius:18px;background:#1e1f22;border:1px solid #2a2b2f}
  .auth span{opacity:.9}
  .auth .sep{opacity:.25}
  .auth .link{padding:6px 12px;border-radius:12px;background:#2a2b2f}
  .menu-toggle{width:48px;height:48px;border-radius:14px;background:#232427;border:0;display:grid;place-items:center}
  .menu-ico,.menu-ico::before,.menu-ico::after{content:"";display:block;width:22px;height:2px;background:#fff;border-radius:2px;position:relative}
  .menu-ico::before{position:absolute;top:-6px}
  .menu-ico::after{position:absolute;top:6px}

  /* ===== 手機抽屜選單（永遠壓在最上層，避免被地圖蓋） ===== */
  .menu{position:fixed;inset:0 0 0 auto;width:min(86vw,340px);transform:translateX(100%);transition:transform .25s ease;background:#0d0e10;z-index:1200;padding:16px}
  .menu.open{transform:none}
  .menu a{display:block;padding:14px 16px;margin:10px 0;border-radius:14px;background:#1b1c1f}
  .menu-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(2px);opacity:0;pointer-events:none;transition:opacity .2s;z-index:1100}
  .menu-backdrop.show{opacity:1;pointer-events:auto}

  /* ===== 通用卡片與頁面 ===== */
  .page{padding:10px 0 40px}
  .card{background:radial-gradient(130% 120% at 100% 0%,#1a1b1e 0%,#111214 60%);border-radius:18px;padding:22px;border:1px solid #1d1e21}
  .pill{display:inline-block;background:var(--chip);color:var(--chip-text);padding:8px 14px;border-radius:999px;font-weight:700}
  .section-caption{font-size:.95rem;color:var(--muted);margin:6px 0 10px}

  /* ===== 首頁 Hero（Logo 正方、與按鈕群對齊） ===== */
  .hero{display:grid;grid-template-columns:1.2fr .9fr;gap:16px;align-items:center}
  .hero-title{font-size:clamp(24px,5.6vw,40px);line-height:1.25;margin:.2rem 0 1rem;word-break:keep-all}
  .hero-copy .btn{margin-right:10px;margin-bottom:10px}
  .hero-visual{display:flex;align-items:center;justify-content:flex-end}
  .hero-logo{width:min(180px,40vw);aspect-ratio:1/1;border-radius:18px;object-fit:cover;box-shadow:0 8px 20px rgba(0,0,0,.35)}
  @media (max-width:900px){ .hero{grid-template-columns:1fr}.hero-visual{justify-content:flex-end} }

  /* ===== 表單與元件 ===== */
  .input, select.input, textarea.input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2a2b2d;background:#101113;color:var(--text)}
  .btn{background:var(--brand);color:#1b1b1b;border:0;border-radius:14px;padding:12px 16px;font-weight:800;cursor:pointer}
  .btn.secondary{background:#26272a;color:#ddd;border:1px solid #2b2c2f}
  .inline{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .grid{display:grid}.g-2{grid-template-columns:repeat(2,1fr);gap:14px}.gcol-2{grid-column:span 2}

  /* ===== 主子卡（列表） ===== */
  .p-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
  .p-card{background:#17181b;border:1px solid #232427;border-radius:14px;padding:12px;display:flex;gap:12px;align-items:center}
  .p-avatar{width:56px;height:56px;border-radius:12px;object-fit:cover}
  .p-edit{margin-left:auto}

  /* ===== 照片牆：IG 六宮格 ===== */
  .grid-photos{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
  .grid-photos .ph{position:relative}
  .grid-photos img{width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:8px;cursor:pointer}
  .grid-photos .badge{position:absolute;right:6px;bottom:6px;background:rgba(0,0,0,.55);color:#fff;font-size:.8rem;padding:2px 6px;border-radius:999px}

  /* ===== 照片預覽 Dialog（右下愛心/留言） ===== */
  dialog{border:0;border-radius:18px;padding:0;max-width:min(92vw,520px)}
  dialog::backdrop{background:rgba(0,0,0,.6)}
  .ph-modal{padding:14px}
  .ph-modal img{width:100%;border-radius:12px}
  .ph-act{position:relative;margin-top:8px;display:flex;justify-content:space-between;align-items:center}
  .ph-act .dock{position:absolute;right:0;bottom:-10px;display:flex;gap:8px}
  .ph-act .dock button{background:#1f2023;color:#eee;border:1px solid #2a2b2f;border-radius:14px;padding:6px 10px}
  .c{font-size:.9rem;color:#aaa;margin:4px 0}

  /* ===== 右下 Top（縮小最圓） ===== */
  .fab{position:fixed;right:14px;bottom:14px;z-index:1050}
  .fab-btn{width:56px;height:56px;border-radius:50%;background:linear-gradient(180deg,#ff895f,#e76938);border:0;color:#1c1c1c;font-weight:900;box-shadow:0 10px 20px rgba(0,0,0,.35)}

  /* ===== 登入 Dialog 外框（深色/淺色） ===== */
  .auth-outer{background:#0b0c0d;border:1px solid #1c1d21;padding:12px;border-radius:20px}
  .auth-card{background:var(--bg-2);border:1px solid #24262a;border-radius:18px;padding:18px}
  @media (prefers-color-scheme: light){
    body{background:#fbfbfb;color:#222}
    .card{background:#fff;border-color:#eee}
    .menu{background:#fff}
    .menu a{background:#f3f4f6}
    .auth-outer{background:#f6f7f8;border-color:#e6e7ea}
    .auth-card{background:#fff;border-color:#e9e9ee}
  }
  </style>
</head>
<body>

<!-- ===============================
     頂部：品牌、訪客/登入、漢堡
     =============================== -->
<header>
  <div class="container topbar">
    <a class="brand" href="#home" onclick="showPage('home');return false;">
      <img src="./logo/logo-192.png" alt="PurrGo">
      <span>PurrGo 喵來速</span>
    </a>

    <!-- 訪客 / 登入（橫向置中） -->
    <div class="auth">
      <span id="userLabel">訪客</span>
      <span class="sep">｜</span>
      <a class="link" href="#" onclick="openLogin();return false;">登入</a>
    </div>

    <!-- 漢堡 -->
    <button class="menu-toggle" aria-label="開啟選單" onclick="openMenu()">
      <span class="menu-ico" aria-hidden="true"></span>
    </button>
  </div>

  <!-- 手機抽屜選單＋遮罩（z-index 很高，避免被地圖覆蓋） -->
  <nav id="menu" class="menu" aria-label="主選單">
    <a href="#home"     onclick="navTo('home')">首頁</a>
    <a href="#products" onclick="navTo('products')">產品</a>
    <a href="#guild"    onclick="navTo('guild')">公會</a>
    <a href="#kiosk"    onclick="navTo('kiosk')">據點</a>
    <a href="#photos"   onclick="navTo('photos')">照片牆</a>
    <a href="#social"   onclick="navTo('social')">社群</a>
    <a href="#chat"     onclick="navTo('chat')">聊天</a>
    <a href="#video"    onclick="navTo('video')">短影片</a>
    <a href="#about"    onclick="navTo('about')">理念</a>
    <a href="#contact"  onclick="navTo('contact')">聯絡</a>
  </nav>
  <div id="menuBackdrop" class="menu-backdrop" onclick="closeMenu()"></div>
</header>

<!-- ===============================
     主內容
     =============================== -->
<main class="container">

  <!-- ===== 首頁 ===== -->
  <section id="page-home" class="page">
    <div class="section-caption">首頁</div>

    <!-- Hero -->
    <section class="hero card">
      <div class="hero-copy">
        <span class="pill">PurrGo 喵來速</span>
        <h1 class="hero-title">便利 × 可愛 × 永續 × 共創</h1>
        <p class="muted">用創新配送＋公會制度，讓補給更聰明、更便宜、更好玩。把「買貓砂」變成有成就感的里程碑遊戲。</p>
        <div class="inline mt-1">
          <a class="btn" onclick="showPage('products')">開始探索產品</a>
          <a class="btn secondary" onclick="showPage('guild')">加入貓奴公會</a>
          <a class="btn secondary" onclick="showPage('about')">了解品牌理念</a>
        </div>
      </div>
      <div class="hero-visual">
        <!-- 正方形導圓角 Logo -->
        <img class="hero-logo" src="./logo/logo-512.png" alt="PurrGo Logo">
      </div>
    </section>

    <!-- 建立主子（不限數量；生日自動換算年齡；第一張頭像自帶入相簿） -->
    <section class="card">
      <span class="pill">主子</span>
      <h2 class="mt-0">建立主子角色</h2>

      <form class="grid g-2" onsubmit="return addPet(event)">
        <div><label>暱稱<input class="input" name="name" required></label></div>
        <div><label>性別<select class="input" name="sex"><option value="M">公</option><option value="F">母</option></select></label></div>
        <div><label>生日<input class="input" name="birth" type="date" required></label></div>
        <div><label>品種<select class="input" id="breedSelect" name="breed"></select></label></div>
        <div class="gcol-2"><label>大頭照<input class="input" name="avatar" type="file" accept="image/*"></label></div>
        <div class="inline"><button class="btn" type="submit">新增主子</button></div>
      </form>

      <!-- 主子清單（卡片；點擊可編輯） -->
      <div id="petRow" class="p-row mt-2"></div>
    </section>
  </section>

  <!-- 其餘分頁（保留結構；此處示意） -->
  <section id="page-products" class="page" hidden><div class="section-caption">產品</div><section class="card">商品區（略）</section></section>
  <section id="page-guild"    class="page" hidden><div class="section-caption">公會</div><section class="card">公會區（略）</section></section>
  <section id="page-kiosk"    class="page" hidden><div class="section-caption">據點</div><section class="card">地圖區（略）</section></section>

  <!-- ===== 照片牆（IG 六宮格＋點擊放大、愛心、留言） ===== -->
  <section id="page-photos" class="page" hidden>
    <div class="section-caption">Photos</div>
    <section class="card">
      <span class="pill">Photos</span>
      <h2 class="mt-0">照片牆（依主子分相簿）</h2>

      <div class="inline mt-1">
        <label>主子
          <select class="input" id="photoPet" onchange="renderWall()"></select>
        </label>
        <input id="photoPicker" type="file" accept="image/*" multiple onchange="addPhoto(event)">
        <button class="btn secondary" onclick="clearWall()">清除本機照片</button>
      </div>

      <div id="wall" class="grid-photos mt-2"></div>
    </section>
  </section>

  <section id="page-social"   class="page" hidden><div class="section-caption">社群</div><section class="card">社群（略）</section></section>
  <section id="page-chat"     class="page" hidden><div class="section-caption">聊天</div><section class="card">聊天（略）</section></section>
  <section id="page-video"    class="page" hidden><div class="section-caption">短影片</div><section class="card">短影片（略）</section></section>
  <section id="page-about"    class="page" hidden><div class="section-caption">理念</div><section class="card">理念（略）</section></section>
  <section id="page-contact"  class="page" hidden><div class="section-caption">聯絡</div><section class="card">聯絡（略）</section></section>

</main>

<footer class="container" style="padding:26px 0 60px;color:var(--muted)">
  © PurrGo 喵來速 ｜ 公開 Demo（不含投資人資訊）
</footer>

<!-- 右下 Top -->
<div class="fab"><button class="fab-btn" onclick="window.scrollTo({top:0,behavior:'smooth'})">Top</button></div>

<!-- ===== 照片預覽 Dialog ===== -->
<dialog id="photoModal">
  <div class="ph-modal">
    <img id="pmImg" alt="photo">
    <div class="ph-act">
      <div id="pmMeta" class="muted">—</div>
      <div class="dock">
        <button onclick="likeCurrent()">♥ <span id="pmLike">0</span></button>
        <button onclick="addCommentCurrent()">留言</button>
        <button onclick="closePhoto()">關閉</button>
      </div>
    </div>
    <div id="pmComments" class="mt-1"></div>
  </div>
</dialog>

<!-- ===== 主子編輯 Dialog（點擊主子卡開啟） ===== -->
<dialog id="petModal">
  <div class="auth-outer">
    <div class="auth-card">
      <h3 class="mt-0">編輯主子</h3>
      <form id="petForm" class="grid g-2" onsubmit="return savePetEdit(event)">
        <div><label>暱稱<input class="input" name="name" required></label></div>
        <div><label>性別<select class="input" name="sex"><option value="M">公</option><option value="F">母</option></select></label></div>
        <div><label>生日<input class="input" name="birth" type="date" required></label></div>
        <div><label>品種<select class="input" id="editBreed" name="breed"></select></label></div>
        <div class="gcol-2"><label>更換頭像<input class="input" name="avatar" type="file" accept="image/*"></label></div>
        <div class="inline"><button class="btn" type="submit">儲存</button><button class="btn secondary" type="button" onclick="closePet()">取消</button></div>
      </form>
    </div>
  </div>
</dialog>

<!-- ===== 登入 Dialog（置中、深色灰底） ===== -->
<dialog id="loginModal">
  <div class="auth-outer">
    <div class="auth-card">
      <h3 class="mt-0">註冊 / 登入</h3>
      <form onsubmit="return doLogin(event)" class="grid g-2">
        <div class="gcol-2"><label>註冊 ID<input class="input" id="loginId" required></label></div>
        <div class="gcol-2"><label>密碼<input class="input" id="loginPw" type="password" required></label></div>
        <div class="gcol-2"><label>手機號碼驗證<input class="input" id="loginPhone" required></label></div>
        <div class="inline"><button class="btn" type="submit">開始使用</button><button class="btn secondary" type="button" onclick="closeLogin()">取消</button></div>
      </form>
      <div class="inline mt-1">
        <button class="btn secondary">使用 LINE 登入（示意）</button>
        <button class="btn secondary">使用 Facebook 登入（示意）</button>
        <button class="btn secondary">使用 Instagram 登入（示意）</button>
        <button class="btn secondary">使用 Gmail 登入（示意）</button>
      </div>
    </div>
  </div>
</dialog>

<!-- ===============================
     JS（可之後拆到 main.js）
     =============================== -->
<script>
/* ===== 全域狀態（localStorage） ===== */
const LS_KEY = 'purrgo_demo';
const state = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
state.user   ||= null;
state.pets   ||= [];       // {id,name,sex,birth,breed,avatar}
state.photos ||= {};       // pid -> [{src,likes,comments:[{text,time}]}]
save();

function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); renderAll(); }

/* ===== SPA 分頁控制 ===== */
const pages = ["home","products","guild","kiosk","photos","social","chat","video","about","contact"];
function showPage(sec){
  pages.forEach(id=>{
    const el = document.getElementById('page-'+id);
    if(el) el.hidden = (id!==sec);
  });
  closeMenu();
  location.hash = '#'+sec;
  if(sec==='photos') renderWall();
}
function navTo(id){ closeMenu(); showPage(id); return false; }
function restorePage(){ const h=(location.hash||'#home').slice(1); showPage(pages.includes(h)?h:'home'); }

/* ===== 手機選單 ===== */
function openMenu(){ document.getElementById('menu').classList.add('open'); document.getElementById('menuBackdrop').classList.add('show'); }
function closeMenu(){ document.getElementById('menu').classList.remove('open'); document.getElementById('menuBackdrop').classList.remove('show'); }

/* ===== 登入（Demo：純本機） ===== */
function openLogin(){ el('loginModal').showModal(); }
function closeLogin(){ el('loginModal').close(); }
function doLogin(e){
  e.preventDefault();
  state.user = { id: el('loginId').value.trim() };
  save(); closeLogin();
}

/* ===== 品種清單（示意） ===== */
function loadBreeds(){
  const breeds = ["美國短毛貓","英國短毛貓","蘇格蘭摺耳貓","布偶貓","米克斯","挪威森林貓","波斯貓","孟加拉豹貓"];
  const selA = el('breedSelect'), selB = el('editBreed');
  [selA, selB].forEach(sel=>{
    sel.innerHTML=''; breeds.forEach(b=>{ const o=document.createElement('option'); o.value=o.textContent=b; sel.appendChild(o); });
  });
}

/* ===== 主子：新增 / 列表 / 編輯 ===== */
function ageFromBirth(iso){ if(!iso) return ''; const b=new Date(iso); const n=new Date(); let y=n.getFullYear()-b.getFullYear(); let m=n.getMonth()-b.getMonth(); if(m<0){y--;m+=12;} return `${y}歲${m>0?m+'個月':''}`; }

function addPet(e){
  e.preventDefault();
  const f=e.target;
  const p={ id:crypto.randomUUID(), name:f.name.value.trim(), sex:f.sex.value, birth:f.birth.value, breed:f.breed.value, avatar:'' };
  const file=f.avatar.files[0];

  // 讀圖是非同步：等讀完再 push，避免第一隻上傳頭像時無法新增
  const pushAndSave=()=>{
    state.pets.push(p);

    // 第一張頭像自動進相簿首張
    if(p.avatar){
      (state.photos[p.id]=state.photos[p.id]||[]).unshift({src:p.avatar,likes:0,comments:[]});
    }
    save(); f.reset();
  };

  if(file){
    const rd=new FileReader();
    rd.onload=()=>{ p.avatar=rd.result; pushAndSave(); };
    rd.readAsDataURL(file);
  }else{
    pushAndSave();
  }
}

function renderPets(){
  const row = el('petRow'); row.innerHTML='';
  state.pets.forEach(pt=>{
    const card=document.createElement('button');
    card.type='button';
    card.className='p-card';
    card.innerHTML = `
      <img src="${pt.avatar || './logo/logo-192.png'}" alt="" class="p-avatar">
      <div>
        <div><b>${pt.name}</b>｜${pt.breed||'未知'}｜${pt.sex==='M'?'公':'母'}</div>
        <div class="muted">年齡：${ageFromBirth(pt.birth)}</div>
      </div>
      <span class="p-edit btn secondary">編輯</span>`;
    card.onclick=()=>openPet(pt.id);
    row.appendChild(card);
  });

  // 同步照片牆主子下拉
  const s=el('photoPet'); s.innerHTML='';
  state.pets.forEach(pt=>{ const o=document.createElement('option'); o.value=pt.id; o.textContent=pt.name; s.appendChild(o); });
}

/* 主子編輯對話框 */
let _editPid=null;
function openPet(pid){
  _editPid=pid;
  const p=state.pets.find(x=>x.id===pid); if(!p) return;
  const f=el('petForm');
  f.name.value=p.name; f.sex.value=p.sex; f.birth.value=p.birth; f.breed.value=p.breed;
  el('petModal').showModal();
}
function closePet(){ el('petModal').close(); _editPid=null; }
function savePetEdit(e){
  e.preventDefault();
  if(!_editPid) return false;
  const f=e.target; const p=state.pets.find(x=>x.id===_editPid); if(!p) return false;
  const file=f.avatar.files[0];

  const apply=()=>{ p.name=f.name.value.trim(); p.sex=f.sex.value; p.birth=f.birth.value; p.breed=f.breed.value; save(); closePet(); };

  if(file){
    const rd=new FileReader();
    rd.onload=()=>{ p.avatar=rd.result; apply(); };
    rd.readAsDataURL(file);
  }else{
    apply();
  }
  return false;
}

/* ===== 照片牆（IG 六宮格） ===== */
function addPhoto(e){
  const pid=el('photoPet').value; if(!pid) return alert('請先建立主子');
  const files=[...e.target.files]; if(!files.length) return;
  files.forEach(file=>{
    const rd=new FileReader();
    rd.onload=()=>{ (state.photos[pid]=state.photos[pid]||[]).push({src:rd.result,likes:0,comments:[]}); save(); };
    rd.readAsDataURL(file);
  });
  // 避免再次選不到同一批檔案
  e.target.value='';
}

function clearWall(){ const pid=el('photoPet').value; if(!pid) return; if(confirm('清除本機相簿照片？')){ state.photos[pid]=[]; save(); } }

function renderWall(){
  const pid=el('photoPet').value || (state.pets[0]?.id||'');
  if(el('photoPet').value!==pid) el('photoPet').value=pid;
  const wall=el('wall'); wall.innerHTML='';
  (state.photos[pid]||[]).forEach((ph,idx)=>{
    const wrap=document.createElement('div'); wrap.className='ph';
    const img=document.createElement('img'); img.src=ph.src; img.alt='';
    img.onclick=()=>openPhoto(pid,idx);
    const badge=document.createElement('div'); badge.className='badge'; badge.textContent=`♥ ${ph.likes||0}`;
    wrap.appendChild(img); wrap.appendChild(badge); wall.appendChild(wrap);
  });
}

/* ===== 照片預覽 / 愛心 / 留言 ===== */
let _pm = { pid:null, idx:-1 };

function openPhoto(pid, idx){
  _pm = { pid, idx };
  const ph = (state.photos[pid]||[])[idx];
  if(!ph) return;

  el('pmImg').src = ph.src;
  el('pmLike').textContent = ph.likes || 0;
  el('pmMeta').textContent = `相片 ${idx+1} ／ 共 ${state.photos[pid].length} 張`;
  renderPhotoComments(ph);

  el('photoModal').showModal();
}
function closePhoto(){
  el('photoModal').close();
  _pm = { pid:null, idx:-1 };
}
function likeCurrent(){
  if(!_pm.pid) return;
  const ph = state.photos[_pm.pid][_pm.idx];
  ph.likes = (ph.likes||0) + 1;
  el('pmLike').textContent = ph.likes;
  save(); // 會同步更新牆上徽章數字
}
function addCommentCurrent(){
  if(!_pm.pid) return;
  const t = prompt('留言內容');
  if(!t) return;
  const ph = state.photos[_pm.pid][_pm.idx];
  (ph.comments = ph.comments || []).push({ text:t, time:new Date().toLocaleString() });
  renderPhotoComments(ph);
  save();
}
function renderPhotoComments(ph){
  const box = el('pmComments'); box.innerHTML = '';
  (ph.comments||[]).slice().reverse().forEach(c=>{
    const d = document.createElement('div');
    d.className = 'c';
    d.textContent = `${c.text} · ${c.time}`;
    box.appendChild(d);
  });
}

/* ===== 小工具與啟動 ===== */
function el(id){ return document.getElementById(id); }

function renderAll(){
  el('userLabel').textContent = state.user ? state.user.id : '訪客';
  renderPets();
  renderWall();
}

function boot(){
  loadBreeds();
  renderAll();
  restorePage();
}
window.addEventListener('hashchange', restorePage);
window.addEventListener('DOMContentLoaded', boot);
</script>
</body>
</html>
