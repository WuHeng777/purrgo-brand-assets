<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PurrGo 喵來速｜品牌官網 Demo</title>

  <!-- PWA / Icons（相對路徑） -->
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./logo/favicon.png">
  <link rel="apple-touch-icon" sizes="192x192" href="./logo/logo-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="./logo/logo-512.png">
  <meta name="theme-color" content="#ff7f50">

  <!-- 你的主樣式 -->
  <link rel="stylesheet" href="./style.css">

  <!-- Hotfix CSS（手機上只改這一檔就好） -->
  <style>
    :root{
      --ease:cubic-bezier(.2,.7,.2,1);
      --shadow-strong:0 18px 36px rgba(0,0,0,.32);
    }
    /* Drawer + Backdrop */
    .menu-toggle{position:relative; z-index:110}
    .menu-ico{width:28px;height:20px;display:inline-grid;place-items:center}
    .menu-ico::before{content:"";width:22px;height:2px;background:currentColor;box-shadow:0 -6px 0,currentColor 0 6px 0}
    .menu-backdrop{
      position:fixed; inset:0; z-index:100;
      background:color-mix(in oklab, #ff7f50 30%, transparent);
      backdrop-filter: blur(1.5px);
      opacity:0; pointer-events:none; transition:.2s ease;
    }
    .menu-panel{
      position:fixed; right:0; top:0; bottom:0; width:min(86vw,360px);
      background:color-mix(in oklab,var(--bg,#0f0f10),#000 6%);
      border-left:1px solid var(--line,#2a2b2d);
      box-shadow:var(--shadow-strong); z-index:101;
      transform:translateX(100%); transition:.24s var(--ease);
      padding:18px;
      display:flex; flex-direction:column; gap:14px;
    }
    .menu-panel a{
      display:block; padding:16px 14px; border-radius:12px;
      border:1px solid var(--line,#2a2b2d);
      background:color-mix(in oklab,var(--bg,#0f0f10),#fff 4%);
      font-weight:800;
    }
    .menu-open .menu-backdrop{opacity:1; pointer-events:auto}
    .menu-open .menu-panel{transform:none}

    /* Paging */
    .page{display:none}
    .page.active{display:block}

    /* FAB */
    .fab{position:fixed; right:18px; bottom:18px; display:grid; gap:12px; z-index:90}
    .fab-btn{
      width:56px;height:56px;border-radius:999px; font-size:12px; font-weight:900;
      background:#ff7f50; color:#000; border:1px solid color-mix(in oklab,#000,transparent 70%);
      box-shadow:0 10px 22px rgba(0,0,0,.25); opacity:.85; transition:.15s ease;
      display:grid; place-items:center;
    }
    .fab-btn:hover{opacity:1; transform:translateY(-1px)}
    .fab-btn:active{opacity:.7; transform:translateY(0)}

    /* 小間距優化，避免卡片重疊 */
    .band{margin-top:8px}
    .band + .band{margin-top:14px}
    .section-head{margin-bottom:10px}
  </style>

  <!-- Leaflet CSS -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous">
</head>
<body>

<header class="container nav" style="display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0">
  <div class="brand" style="display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.5px">
    <span class="logo" style="width:28px;height:28px;border-radius:8px;background:#ff7f50;display:grid;place-items:center;color:#000;font-weight:900">G</span>
    PurrGo 喵來速
  </div>

  <!-- 漢堡 -->
  <button class="menu-toggle" aria-label="開啟選單" onclick="openMenu()">
    <span class="menu-ico" aria-hidden="true"></span>
  </button>
</header>

<!-- Drawer -->
<div id="menuBackdrop" class="menu-backdrop" onclick="closeMenu()"></div>
<nav id="menuPanel" class="menu-panel" aria-label="站內選單">
  <a href="#" onclick="go('home');return false;">首頁</a>
  <a href="#" onclick="go('products');return false;">產品</a>
  <a href="#" onclick="go('guild');return false;">公會</a>
  <a href="#" onclick="go('kiosk');return false;">據點</a>
  <a href="#" onclick="go('community');return false;">照片牆</a>
  <a href="#" onclick="go('about');return false;">理念</a>
  <a href="#" onclick="go('contact');return false;">聯絡</a>
</nav>

<main class="container" style="padding:10px 0 80px">

  <!-- Home -->
  <section id="page-home" class="page active">
    <section class="hero card">
      <div class="hero-copy">
        <span class="pill">PurrGo 喵來速</span>
        <h1 class="hero-title">便利 × 可愛 × 永續 × 共創</h1>
        <p class="muted">
          我們用創新配送與社群化公會制度，讓補給變得更聰明、更便宜、更好玩。<br>
          把「買貓砂」變成一種有成就感的里程碑遊戲。
        </p>
        <div class="inline mt-1">
          <a class="btn" onclick="go('products')">開始探索產品</a>
          <a class="btn secondary" onclick="go('guild')">加入貓奴公會</a>
        </div>
      </div>
      <div class="hero-art">
        <div class="hero-visual">
          <img src="./logo/logo-512.png" alt="PurrGo Logo" class="hero-logo">
        </div>
      </div>
    </section>
  </section>

  <!-- Products -->
  <section id="page-products" class="page">
    <section class="band">
      <header class="section-head">
        <span class="pill">Products</span>
        <h2 class="mt-0">熱銷與方案</h2>
        <p class="section-sub muted">橫向滑動卡片，支援產品照片、詳情彈窗與加入購物車。</p>
      </header>

      <!-- 橫向滑動列（用現有 CSS 類別） -->
      <div class="hwrap">
        <button class="hbtn prev" aria-label="上一卡" onclick="scrollRow('productRow',-1)">‹</button>
        <div id="productRow" class="hscroll"></div>
        <button class="hbtn next" aria-label="下一卡" onclick="scrollRow('productRow',1)">›</button>
      </div>

      <div class="card">
        <h3 class="mt-0">購物車（示範）</h3>
        <div id="cartItems" class="muted">尚無商品</div>
        <div class="inline mt-1">
          <button class="btn" onclick="checkout()">結帳（示範）</button>
          <button class="btn secondary" onclick="clearCart()">清空</button>
        </div>
      </div>
    </section>
  </section>

  <!-- Guild -->
  <section id="page-guild" class="page">
    <header class="section-head">
      <span class="pill">Guild</span>
      <h2 class="mt-0">公會制度：一起成長‧一起更省</h2>
      <p class="section-sub muted">創立門檻、VIP 等級、貢獻條、任務卡片化呈現。</p>
    </header>

    <div class="grid g-2">
      <div class="card">
        <h3 class="mt-0">創立門檻</h3>
        <p class="muted">會長資格：累積消費 ≥ <b>$1,200</b>（示範）</p>
        <div class="inline">
          <input class="input" placeholder="輸入手機號碼" oninput="bindPhone(this.value)" style="width:220px">
          <button class="btn" onclick="toggleLine()">綁定 LINE（示意）</button>
        </div>
        <p id="identityInfo" class="muted mt-1">尚未綁定手機</p>
        <div class="inline mt-1">
          <button class="btn" onclick="createGuild()">創立公會</button>
        </div>
      </div>

      <div class="card">
        <h3 class="mt-0">VIP 等級與簽到</h3>
        <p class="muted">終身消費：<b id="lifetimeSpend">$0</b> ｜ 當前等級：<b id="vipLevel">V0</b></p>
        <div class="inline">
          <button class="btn" onclick="dailyCheckin()">每日簽到</button>
          <span id="checkinInfo" class="muted"></span>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="mt-0">公會狀態</h3>
      <p class="muted">名稱：<b id="guildName">（尚未創立）</b> ｜ 等級：<b id="guildLevel">–</b> ｜ 貢獻：<b id="guildContrib">0</b></p>
      <div class="inline">
        <button class="btn" onclick="contribute(120)">每日任務 +120</button>
        <button class="btn secondary" onclick="mockWar()">展開：區域戰排行（示範）</button>
      </div>
      <table class="table mt-1">
        <thead><tr><th>名次</th><th>公會</th><th>區域</th><th>分數</th></tr></thead>
        <tbody id="warTable"></tbody>
      </table>
    </div>

    <!-- 健檢上傳（示範） -->
    <div class="card">
      <span class="pill">健檢上傳（示範）</span>
      <h3 class="mt-0">合作獸醫院健檢報告上傳</h3>
      <div class="grid g-2">
        <label>地區
          <select class="input" id="hospitalCity" onchange="renderHospitals()">
            <option>台北</option><option>台中</option><option>高雄</option>
          </select>
        </label>
        <label>院所
          <select class="input" id="hospitalList"></select>
        </label>
        <label class="gcol-2">檔案（PDF/JPG）
          <input type="file" class="input" accept=".pdf,image/*" onchange="uploadCheck(event)">
        </label>
      </div>
      <div id="uploadNote" class="muted mt-1">完成上傳可獲得公會貢獻 +50（示範）。</div>
    </div>
  </section>

  <!-- Kiosk -->
  <section id="page-kiosk" class="page">
    <header class="section-head">
      <span class="pill">Kiosk</span>
      <h2 class="mt-0">販賣機點位</h2>
      <p class="muted">點擊標記可開啟 Google/Apple Maps 導航。</p>
    </header>
    <div id="map" style="height:360px;border-radius:12px;overflow:hidden"></div>
  </section>

  <!-- Community -->
  <section id="page-community" class="page">
    <header class="section-head">
      <span class="pill">Community</span>
      <h2 class="mt-0">照片牆（本機示範）</h2>
    </header>
    <div class="inline">
      <input type="file" accept="image/*" onchange="addPhoto(event)">
      <button class="btn secondary" onclick="clearWall()">清除所有照片（本機）</button>
    </div>
    <div id="wall" class="grid g-3 mt-2"></div>
  </section>

  <!-- About -->
  <section id="page-about" class="page">
    <header class="section-head">
      <span class="pill">About</span>
      <h2 class="mt-0">我們相信「便利 × 可愛 × 永續 × 共創」</h2>
    </header>
    <p class="muted">
      PurrGo 喵來速不只是賣貓砂。我們用「創新配送」結合「公會化社群」，讓補給更聰明、更便宜、更好玩。
    </p>
  </section>

  <!-- Contact -->
  <section id="page-contact" class="page">
    <header class="section-head">
      <span class="pill">Contact</span>
      <h2 class="mt-0">聯絡我們</h2>
    </header>
    <form class="grid g-2" onsubmit="return submitForm(event)">
      <div><label>您的稱呼<input class="input" required></label></div>
      <div><label>Email<input type="email" class="input" required></label></div>
      <div class="gcol-2"><label>訊息<textarea class="input" required></textarea></label></div>
      <div class="inline"><button class="btn" type="submit">送出</button></div>
    </form>
    <p class="muted mt-1">也可來信：<a href="mailto:hello@purrgo.tw">hello@purrgo.tw</a> ｜ LINE 官方：@purrgo</p>
  </section>

</main>

<footer class="container" style="padding:26px 0 60px;color:var(--muted)">
  © PurrGo 喵來速 ｜ 公開 Demo
</footer>

<!-- FAB -->
<div class="fab" id="fab">
  <button class="fab-btn" onclick="goTop()">Top</button>
  <button class="fab-btn" onclick="go('products')">Shop</button>
  <button class="fab-btn" onclick="go('guild')">Guild</button>
  <button class="fab-btn" onclick="go('kiosk')">Map</button>
  <button class="fab-btn" onclick="go('contact')">Msg</button>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>

<!-- Main Script -->
<script>
/* ===== 快捷工具 ===== */
const qs = s => document.querySelector(s);
const qsa = s => [...document.querySelectorAll(s)];

/* ===== State（localStorage） ===== */
const LS_KEY = 'purrgoState';
const state = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
state.user   ||= { phone:'', line:false, vipXp:0, lifetimeSpend:0, energy:0, lastCheckin:'' };
state.guild  ||= { name:'', level:0, contribution:0 };
state.cart   ||= [];
state.vet    ||= [];
function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
  renderIdentity(); renderVIP(); renderGuild(); renderCart(); renderWall();
}

/* ===== Paging ===== */
function setActivePage(id){
  qsa('.page').forEach(s=>s.classList.remove('active'));
  const sec = qs('#page-'+id);
  if(sec){ sec.classList.add('active'); window.scrollTo({top:0,behavior:'instant'}) }
}
function go(id){ setActivePage(id); closeMenu(); }
function openMenu(){ document.documentElement.classList.add('menu-open'); }
function closeMenu(){ document.documentElement.classList.remove('menu-open'); }
function goTop(){ window.scrollTo({top:0,behavior:'smooth'}) }

/* ===== 身份 / 綁定 ===== */
function bindPhone(v){ state.user.phone=v||''; save(); }
function toggleLine(){ state.user.line=!state.user.line; save(); }
function renderIdentity(){
  if(!qs('#identityInfo')) return;
  qs('#identityInfo').textContent = state.user.phone ?
    `已綁定：${state.user.phone} ｜ LINE：${state.user.line?'已連結':'未連結'}` : '尚未綁定手機';
}

/* ===== VIP / 簽到 ===== */
function vipLevelByXp(x){ if(x>=5000) return 5; if(x>=3000) return 4; if(x>=1500) return 3; if(x>=600) return 2; if(x>=200) return 1; return 0; }
function renderVIP(){
  if(!qs('#vipLevel')) return;
  const xp = state.user.vipXp|0;
  qs('#lifetimeSpend').textContent = `$${(state.user.lifetimeSpend||0).toLocaleString()}`;
  qs('#vipLevel').textContent = 'V'+vipLevelByXp(xp);
}
function dailyCheckin(){
  const today = new Date().toISOString().slice(0,10);
  if(state.user.lastCheckin===today){ if(qs('#checkinInfo')) qs('#checkinInfo').textContent='今天已簽到'; return; }
  state.user.lastCheckin=today; state.user.energy+=10; state.user.vipXp+=10;
  if(qs('#checkinInfo')) qs('#checkinInfo').textContent='簽到成功：+10 能量、+10 VIP XP';
  save();
}

/* ===== 產品 / 購物 ===== */
async function loadProducts(){
  try{
    const list = await fetch('./data/products.json',{cache:'no-cache'}).then(r=>r.json());
    const row = qs('#productRow'); if(!row) return; row.innerHTML='';
    list.forEach(p=>{
      const el = document.createElement('div'); el.className='card'; el.style.minWidth='280px';
      el.innerHTML = `
        <img src="${p.img||'./img/tofu-adult.jpg'}" alt="" style="width:100%;border-radius:12px">
        <h3 class="mt-1">${p.name}</h3>
        <div class="muted">${p.spec||''}</div>
        <div class="mt-1"><b>NT$ ${p.price.toLocaleString()}</b></div>
        <div class="inline mt-1">
          <button class="btn" onclick='addToCart(${JSON.stringify(p).replace(/'/g,"&#39;")})'>加入購物車</button>
          <button class="btn secondary" onclick='alert("示範：商品詳情彈窗")'>查看詳情</button>
        </div>`;
      row.appendChild(el);
    });
  }catch(e){ if(qs('#productRow')) qs('#productRow').innerHTML='<div class="empty">讀取產品失敗</div>'; }
}
function scrollRow(id,dir){ const el=qs('#'+id); if(el) el.scrollBy({left: dir*300, behavior:'smooth'}); }
function addToCart(p){ const item = state.cart.find(i=>i.id===p.id) || (state.cart.push({...p,qty:0}), state.cart.find(i=>i.id===p.id)); item.qty++; save(); }
function clearCart(){ state.cart=[]; save(); }
function renderCart(){
  const box = qs('#cartItems'); if(!box) return;
  if(state.cart.length===0){ box.textContent='尚無商品'; return; }
  let sum=0; box.innerHTML = state.cart.map(i=>{ sum+=i.price*i.qty; return `${i.name} × ${i.qty} = NT$ ${(i.price*i.qty).toLocaleString()}`; }).join('<br>');
  box.innerHTML += `<div class="mt-1"><b>小計：NT$ ${sum.toLocaleString()}</b></div>`;
}
function checkout(){
  if(state.cart.length===0) return alert('購物車是空的');
  const sum = state.cart.reduce((a,b)=>a+b.price*b.qty,0);
  state.user.lifetimeSpend = (state.user.lifetimeSpend||0) + sum;
  state.user.vipXp += Math.round(sum/10);
  state.user.energy += Math.round(sum/20);
  state.cart=[]; alert(`結帳成功！累積消費 +$${sum.toLocaleString()}，VIP XP 與能量已增加`);
  save();
}

/* ===== 公會 ===== */
const GUILD_CREATE_NEED = 1200;
function renderGuild(){
  if(!qs('#guildName')) return;
  qs('#guildName').textContent = state.guild.name||'（尚未創立）';
  qs('#guildLevel').textContent = state.guild.level||'–';
  qs('#guildContrib').textContent = state.guild.contribution|0;
}
function createGuild(){
  if((state.user.lifetimeSpend||0) < GUILD_CREATE_NEED){ return alert('尚未達到創立門檻：累積消費 $1,200'); }
  const name = prompt('輸入公會名稱'); if(!name) return;
  state.guild.name=name; state.guild.level=1; save(); alert('公會已創立！');
}
function contribute(n){ if(!state.guild.name) return alert('請先創立公會'); state.guild.contribution += n; if(state.guild.contribution>= (state.guild.level*500)) { state.guild.level++; alert('公會升級！'); } save(); }
function mockWar(){ if(!qs('#warTable')) return; const add=Math.floor(Math.random()*500+100); const tr=document.createElement('tr'); tr.innerHTML=`<td>*</td><td>${state.guild.name||'—'}</td><td>你的區域</td><td>+${add}</td>`; qs('#warTable').prepend(tr); }

/* 健檢上傳（示範） */
async function renderHospitals(){
  try{
    const city = qs('#hospitalCity').value;
    const data = await fetch('./data/hospitals.json',{cache:'no-cache'}).then(r=>r.json());
    const sel = qs('#hospitalList'); if(!sel) return; sel.innerHTML='';
    (data[city]||[]).forEach(name=>{
      const opt=document.createElement('option'); opt.textContent=name; sel.appendChild(opt);
    });
  }catch(e){}
}
function uploadCheck(e){
  const f = e.target.files?.[0]; if(!f) return;
  alert(`已接收 ${f.name}（示範），公會貢獻 +50！`);
  state.guild.contribution = (state.guild.contribution|0) + 50; save();
}

/* ===== 照片牆（本機） ===== */
function addPhoto(e){ const file=e.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>{ state.wall = state.wall||[]; state.wall.push(reader.result); save(); }; reader.readAsDataURL(file); }
function renderWall(){ const wall=qs('#wall'); if(!wall) return; wall.innerHTML=''; (state.wall||[]).forEach(src=>{ const img=new Image(); img.src=src; img.style.borderRadius='12px'; wall.appendChild(img); }); }
function clearWall(){ if(confirm('清除所有本機照片？')){ state.wall=[]; save(); }}

/* ===== 地圖 ===== */
async function initMap(){
  const map=L.map('map').setView([25.0330,121.5654],12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OpenStreetMap'}).addTo(map);
  try{
    const points = await fetch('./data/locations.json',{cache:'no-cache'}).then(r=>r.json());
    points.forEach(p=>{
      const m=L.marker([p.lat,p.lng]).addTo(map);
      const g=`https://www.google.com/maps?q=${p.lat},${p.lng}`;
      const a=`https://maps.apple.com/?q=${p.lat},${p.lng}`;
      m.bindPopup(`<b>${p.name}</b><br>${p.address||''}<br><a href='${g}' target='_blank'>Google Maps</a> ｜ <a href='${a}' target='_blank'>Apple Maps</a>`);
    });
  }catch(e){}
}

/* ===== 聯絡表單 ===== */
function submitForm(e){ e.preventDefault(); alert('已收到您的訊息（示範）'); e.target.reset(); return false; }

/* ===== 啟動 ===== */
document.addEventListener('DOMContentLoaded',()=>{
  setActivePage('home');
  loadProducts();
  renderHospitals();
  renderIdentity(); renderVIP(); renderGuild(); renderCart(); renderWall();
  if(qs('#map')) initMap();
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
});
</script>
</body>
</html>
