<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PurrGo 喵來速｜品牌 Demo</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./logo/favicon.png">
  <link rel="apple-touch-icon" sizes="192x192" href="./logo/logo-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="./logo/logo-512.png">
  <meta name="theme-color" content="#ff7f50">

  <!-- Base CSS -->
  <link rel="stylesheet" href="./style.css">

  <!-- Leaflet CSS (地圖) -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous">
  <style>
    /* ============ 補強樣式（直接加入 style.css 也可） ============ */
    :root{
      --panel-bg-dark: rgba(16,16,16,.92);
      --panel-ink-dark: #fff;
      --panel-bg-light: rgba(255,255,255,.96);
      --panel-ink-light: #111;
    }
    @media (prefers-color-scheme: dark){
      :root{ --panel-bg: var(--panel-bg-dark); --panel-ink: var(--panel-ink-dark); }
    }
    @media (prefers-color-scheme: light){
      :root{ --panel-bg: var(--panel-bg-light); --panel-ink: var(--panel-ink-light); }
    }

    /* Header 基本排版（你的 style.css 已有，這裡只補必要） */
    header{ position:sticky; top:0; z-index:50; backdrop-filter:saturate(180%) blur(10px); }
    .nav{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0 }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:900 }
    .logo{ width:28px; height:28px; border-radius:8px; background:#ff7f50; display:grid; place-items:center; font-weight:900; color:#000 }

    .tabs{ display:flex; gap:6px; flex-wrap:wrap }
    .tab{ padding:8px 12px; border:1px solid var(--line); border-radius:999px; font-weight:700 }
    .tab[aria-current="page"]{ background:#ff7f50; color:#000; border-color:#ff7f50 }

    /* 手機：隱藏 tabs，改用漢堡 */
    @media (max-width: 900px){ .tabs{ display:none } }

    /* 漢堡按鈕 */
    .menu-toggle{
      appearance:none; -webkit-appearance:none;
      border:1px solid var(--line);
      background:color-mix(in oklab, var(--bg), #000 6%);
      color:var(--ink);
      width:44px; height:44px; border-radius:14px;
      display:grid; place-items:center; cursor:pointer;
    }
    .menu-toggle:focus{ outline:none }
    .menu-ico{ position:relative; width:20px; height:2px; background:currentColor; border-radius:2px }
    .menu-ico::before,.menu-ico::after{
      content:""; position:absolute; left:0; right:0; height:2px; background:currentColor; border-radius:2px
    }
    .menu-ico::before{ top:-6px } .menu-ico::after{ top:6px }

    /* 側邊選單 + 半透明背景罩（確保在地圖之上） */
    .menu-backdrop{
      position:fixed; inset:0; background:rgba(255,127,50,.30); /* 品牌橘 30% */
      backdrop-filter: blur(2px); z-index: 9998; display:none;
    }
    .menu{
      position:fixed; top:70px; right:12px; width:min(92vw,380px);
      z-index:9999; display:none;
    }
    .menu.open, .menu-backdrop.open{ display:block }
    .menu a{
      display:block; color:var(--panel-ink);
      background:var(--panel-bg);
      border:1px solid color-mix(in oklab, var(--panel-ink), transparent 80%);
      border-radius:18px; padding:18px 20px; margin:12px 0; font-weight:800;
    }

    /* 圓形 FAB */
    .fab{ position:fixed; right:18px; bottom:18px; display:grid; gap:12px; z-index:60 }
    .fab-btn{
      width:64px; height:64px; border-radius:999px; border:0;
      background: radial-gradient(120% 120% at 30% 20%, #ff9966 0%, #ff7f50 60%, #d9663a 100%);
      color:#000; font-weight:900; font-size:14px; display:grid; place-items:center;
      box-shadow: 0 10px 24px rgba(0,0,0,.25); transition: transform .12s, opacity .12s;
      opacity:.85; cursor:pointer;
    }
    .fab-btn:hover{ transform: translateY(-2px); opacity:1 }
    .fab-btn:active{ transform: translateY(0); opacity:.75 }

    /* 區塊寬度 */
    .container{ width:min(1100px,92vw); margin:auto }
    main{ padding:26px 0 80px }
    .page[hidden]{ display:none !important }

    /* 產品區標題在小螢幕不要強制換行 */
    @media (max-width:480px){
      #page-products h2{ font-size:22px; letter-spacing:.5px; white-space:nowrap }
    }
    /* 卡片間距避免重疊 */
    .band{ margin:8px 0 18px }
    .band .card{ margin:12px 0 }
  </style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="brand">
      <div class="logo">G</div>
      <div>PurrGo 喵來速</div>
    </div>

    <!-- 桌面導覽（手機隱藏） -->
    <nav class="tabs">
      <a class="tab" data-sec="home"      href="#home">首頁</a>
      <a class="tab" data-sec="products"  href="#products">產品</a>
      <a class="tab" data-sec="guild"     href="#guild">公會</a>
      <a class="tab" data-sec="kiosk"     href="#kiosk">據點</a>
      <a class="tab" data-sec="community" href="#community">照片牆</a>
      <a class="tab" data-sec="social"    href="#social">社群</a>
      <a class="tab" data-sec="chat"      href="#chat">聊天</a>
      <a class="tab" data-sec="about"     href="#about">理念</a>
      <a class="tab" data-sec="contact"   href="#contact">聯絡</a>
    </nav>

    <!-- 手機：漢堡 -->
    <button class="menu-toggle" aria-label="開啟選單" onclick="openMenu()">
      <span class="menu-ico" aria-hidden="true"></span>
    </button>
  </div>

  <!-- 手機：抽屜式選單 & 遮罩 -->
  <nav id="menu" class="menu" aria-label="行動選單">
    <a href="#home"      onclick="go('home')">首頁</a>
    <a href="#products"  onclick="go('products')">產品</a>
    <a href="#guild"     onclick="go('guild')">公會</a>
    <a href="#kiosk"     onclick="go('kiosk')">據點</a>
    <a href="#community" onclick="go('community')">照片牆</a>
    <a href="#social"    onclick="go('social')">社群</a>
    <a href="#chat"      onclick="go('chat')">聊天</a>
    <a href="#about"     onclick="go('about')">理念</a>
    <a href="#contact"   onclick="go('contact')">聯絡</a>
  </nav>
  <div id="menuBackdrop" class="menu-backdrop" onclick="closeMenu()"></div>
</header>


<main class="container">
  <!-- ================== Home ================== -->
  <section id="page-home" class="page">
    <section class="card hero">
      <div>
        <span class="pill">PurrGo 喵來速</span>
        <h1 class="hero-title">便利 × 可愛 × 永續 × 共創</h1>
        <p class="muted">用創新配送 + 公會制度，讓補給更聰明、更便宜、更好玩。把「買貓砂」變成有成就感的里程碑遊戲。</p>
        <div class="inline mt-1">
          <a class="btn" href="#products" onclick="go('products')">開始探索產品</a>
          <a class="btn secondary" href="#guild" onclick="go('guild')">加入貓奴公會</a>
          <a class="btn tertiary" href="#about" onclick="go('about')">了解品牌理念</a>
        </div>
      </div>
      <div>
        <img src="./logo/logo-512.png" alt="PurrGo Logo" style="width:220px;height:220px;object-fit:contain; margin:auto">
      </div>
    </section>

    <section class="card">
      <span class="pill">快速入口</span>
      <div class="inline">
        <button class="btn" onclick="go('products')">熱銷方案</button>
        <button class="btn secondary" onclick="go('kiosk')">附近據點</button>
        <button class="btn secondary" onclick="go('community')">照片牆</button>
      </div>
    </section>
  </section>

  <!-- ================== Products ================== -->
  <section id="page-products" class="page" hidden>
    <section class="band">
      <header class="section-head">
        <span class="pill">Products</span>
        <h2 class="mt-0">熱銷方案</h2>
        <p class="muted">橫向滑動卡片，支援產品照片、詳情彈窗與加入購物車。</p>
      </header>

      <!-- 橫向滑動列 -->
      <div class="hwrap">
        <div id="productRow" class="hscroll" style="display:flex; gap:14px; overflow-x:auto; scroll-snap-type:x mandatory; padding-bottom:10px"></div>
      </div>

      <section class="card">
        <h3 class="mt-0">購物車（示範）</h3>
        <div id="cartItems" class="muted">尚無商品</div>
        <div class="inline mt-1">
          <button class="btn" onclick="checkout()">結帳（示範）</button>
          <button class="btn secondary" onclick="clearCart()">清空</button>
        </div>
      </section>
    </section>
  </section>

  <!-- ================== Guild ================== -->
  <section id="page-guild" class="page" hidden>
    <section class="band">
      <header class="section-head">
        <span class="pill">Guild</span>
        <h2 class="mt-0">公會制度：一起成長・一起更省</h2>
        <p class="muted">創立門檻、VIP 等級、貢獻條、每日任務（示範）。</p>
      </header>

      <section class="card">
        <h3 class="mt-0">創立門檻</h3>
        <p class="muted">會長資格：累積消費 ≥ <b>$1,200</b></p>
        <div class="inline">
          <input class="input" id="phone" placeholder="輸入手機號碼">
          <button class="btn" onclick="bindPhone(document.getElementById('phone').value)">綁定手機（示意）</button>
        </div>
        <div id="identityInfo" class="muted mt-1">尚未綁定手機</div>
        <div class="inline mt-1">
          <button class="btn secondary" id="lineBtn" onclick="toggleLine()">綁定 LINE（示意）</button>
          <button class="btn" onclick="createGuild()">創立公會</button>
        </div>
        <div class="mt-1">公會：<b id="guildName">（尚未創立）</b> ｜ 等級 <b id="guildLevel">–</b> ｜ 貢獻 <b id="guildContrib">0</b></div>
        <div class="inline mt-1">
          <button class="btn" onclick="contribute(50)">捐獻 +50</button>
          <button class="btn secondary" onclick="mockWar()">模擬區域戰 + 隨機分</button>
        </div>
      </section>

      <!-- 我的貓 + 健檢上傳（Demo） -->
      <section class="card">
        <span class="pill">我的貓</span>
        <div class="inline">
          <input id="catName" class="input" placeholder="主子名稱">
          <select id="catGender" class="input" style="max-width:140px">
            <option value="F">母</option><option value="M">公</option>
          </select>
          <select id="catBreed" class="input" style="max-width:180px"></select>
          <button class="btn" onclick="addCat()">新增</button>
        </div>
        <div id="catList" class="grid g-3 mt-1"></div>
      </section>

      <section class="card">
        <span class="pill">健檢上傳（示範）</span>
        <p class="muted">尚未加入/創立公會將無法上傳。</p>
        <div class="inline">
          <select id="vetCatSel" class="input" style="max-width:220px"></select>
          <input id="vetFile" type="file" accept=".pdf,.jpg,.png" class="input" style="max-width:240px">
          <button class="btn" onclick="uploadVet()">上傳</button>
        </div>
        <div class="muted mt-1" id="vetNote">上傳成功會 +10 公會貢獻（示範）</div>
      </section>

      <section class="card">
        <h3 class="mt-0">展開：區域戰排行（示範）</h3>
        <table class="table">
          <thead><tr><th>名次</th><th>公會聯絡</th><th>區域</th><th>分數</th></tr></thead>
          <tbody id="warTable"></tbody>
        </table>
      </section>
    </section>
  </section>

  <!-- ================== Kiosk（地圖） ================== -->
  <section id="page-kiosk" class="page" hidden>
    <section class="card">
      <span class="pill">Kiosk</span>
      <h2 class="mt-0">販賣機點位</h2>
      <div id="map" style="height:360px;border-radius:12px;overflow:hidden"></div>
      <div class="muted mt-1">點擊標記可開啟 Google/Apple Maps 導航。</div>
    </section>
  </section>

  <!-- ================== Community / Social / Chat / About / Contact（占位） ================== -->
  <section id="page-community" class="page" hidden>
    <section class="card">
      <span class="pill">Community</span>
      <h2 class="mt-0">照片牆（示範）</h2>
      <div class="inline">
        <input type="file" accept="image/*" onchange="addPhoto(event)">
        <button class="btn secondary" onclick="clearWall()">清除所有照片（本機）</button>
      </div>
      <div id="wall" class="grid g-3 mt-2"></div>
    </section>
  </section>

  <section id="page-social" class="page" hidden>
    <section class="card">
      <span class="pill">Social</span>
      <h2 class="mt-0">社群雛形（Demo）</h2>
      <p class="muted">後續可接後端（Supabase/Firebase）。先展示流程與 UI。</p>
    </section>
  </section>

  <section id="page-chat" class="page" hidden>
    <section class="card">
      <span class="pill">Chat</span>
      <h2 class="mt-0">聊天雛形（Demo）</h2>
      <p class="muted">好友、封鎖、私訊與 30 秒短影片將在下一階段串接。</p>
    </section>
  </section>

  <section id="page-about" class="page" hidden>
    <section class="card">
      <span class="pill">About</span>
      <h2 class="mt-0">我們相信「便利 × 可愛 × 永續 × 共創」</h2>
      <p class="muted">以永續思維、社群共創，讓日常補給更聰明、更便宜、更好玩。</p>
    </section>
  </section>

  <section id="page-contact" class="page" hidden>
    <section class="card">
      <span class="pill">Contact</span>
      <h2 class="mt-0">聯絡我們</h2>
      <form class="grid g-2" onsubmit="return submitForm(event)">
        <div><label>您的稱呼<input class="input" required></label></div>
        <div><label>Email<input type="email" class="input" required></label></div>
        <div class="gcol-2"><label>訊息<textarea class="input" required></textarea></label></div>
        <div class="inline"><button class="btn" type="submit">送出</button></div>
      </form>
      <p class="muted mt-1">也可來信：<a href="mailto:hello@purrgo.tw">hello@purrgo.tw</a></p>
    </section>
  </section>
</main>

<footer class="container" style="padding:26px 0 60px;color:var(--muted)">
  © PurrGo 喵來速 ｜ 公開 Demo
</footer>

<!-- 右側 FAB -->
<div class="fab" id="fab" aria-label="快速導覽">
  <button class="fab-btn" title="回到頂端" onclick="go('home')">Top</button>
  <button class="fab-btn" title="看產品"  onclick="go('products')">Shop</button>
  <button class="fab-btn" title="看公會"  onclick="go('guild')">Guild</button>
  <button class="fab-btn" title="看據點"  onclick="go('kiosk')">Map</button>
  <button class="fab-btn" title="聯絡我們" onclick="go('contact')">Msg</button>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>

<!-- Main Script -->
<script>
/* ========== 狀態 ========== */
const LS_KEY = 'purrgoState';
const state = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
state.user  ||= { phone:'', line:false, vipXp:0, lifetimeSpend:0, energy:0, lastCheckin:'' };
state.guild ||= { name:'', level:0, contribution:0 };
state.cart  ||= [];
state.vet   ||= [];
state.wall  ||= [];
state.cats  ||= [];     // [{id,name,gender,breed}]
save();

function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); renderIdentity(); renderVIP(); renderGuild(); renderCart(); renderWall(); }

/* ========== 導覽 / 分頁 ========== */
const PAGES = ['home','products','guild','kiosk','community','social','chat','about','contact'];

function openMenu(){ document.getElementById('menu').classList.add('open'); document.getElementById('menuBackdrop').classList.add('open'); }
function closeMenu(){ document.getElementById('menu').classList.remove('open'); document.getElementById('menuBackdrop').classList.remove('open'); }

function show(page){
  document.querySelectorAll('.page').forEach(sec=> sec.hidden = (sec.id !== 'page-' + page));
  document.querySelectorAll('[data-sec]').forEach(a=> a.setAttribute('aria-current', a.dataset.sec===page?'page':'false'));
  closeMenu();
  window.scrollTo({top:0, behavior:'instant'});
}
function go(page){ location.hash = page; show(page); }
function initRouter(){ let h = location.hash.replace('#',''); if(!PAGES.includes(h)) h='home'; show(h); }
window.addEventListener('hashchange', initRouter);
window.addEventListener('DOMContentLoaded', initRouter);

/* ========== 身分 / 綁定 ========== */
function bindPhone(v){ state.user.phone=v||''; save(); }
function toggleLine(){ state.user.line=!state.user.line; save(); }
function renderIdentity(){
  const el=document.getElementById('identityInfo'); const btn=document.getElementById('lineBtn'); if(!el||!btn) return;
  el.textContent = state.user.phone ? `已綁定：${state.user.phone} ｜ LINE：${state.user.line?'已連結':'未連結'}` : '尚未綁定手機';
  btn.textContent = state.user.line? '取消 LINE 連結（示意）':'綁定 LINE（示意）';
}

/* ========== VIP / 能量（顯示） ========== */
function vipLevelByXp(x){ if(x>=5000) return 5; if(x>=3000) return 4; if(x>=1500) return 3; if(x>=600) return 2; if(x>=200) return 1; return 0; }
function renderVIP(){ /* 可擴充顯示於某區塊 */ }

/* ========== 產品 / 購物車 ========== */
async function loadProducts(){
  try{
    const list = await (await fetch('./data/products.json',{cache:'no-cache'})).json();
    const row = document.getElementById('productRow'); if(!row) return; row.innerHTML='';
    list.forEach(p=>{
      const el = document.createElement('article'); el.className='card'; el.style.minWidth='280px'; el.style.scrollSnapAlign='start';
      el.innerHTML = `
        <img src="${p.img||'./img/placeholder.jpg'}" alt="" style="width:100%;height:320px;object-fit:cover;border-radius:12px">
        <h3 class="mt-1">${p.name}</h3>
        <div class="muted">${p.spec||''}</div>
        <div class="mt-1"><b>NT$ ${p.price.toLocaleString()}</b></div>
        ${(p.bullets||[]).length? `<ul class="list">${p.bullets.map(b=>`<li>${b}</li>`).join('')}</ul>`:''}
        <div class="inline mt-1">
          <button class="btn" onclick='addToCart(${JSON.stringify(p).replace(/'/g,"&#39;")})'>加入購物車</button>
          <button class="btn secondary" onclick="alert('Demo：之後顯示商品詳情彈窗')">查看詳情</button>
        </div>`;
      row.appendChild(el);
    });
  }catch(e){ const row=document.getElementById('productRow'); if(row) row.innerHTML='<div class="empty">讀取產品失敗</div>'; }
}
function addToCart(p){ const item = state.cart.find(i=>i.id===p.id) || (state.cart.push({...p,qty:0}), state.cart.find(i=>i.id===p.id)); item.qty++; save(); }
function clearCart(){ state.cart=[]; save(); }
function renderCart(){
  const box = document.getElementById('cartItems'); if(!box) return;
  if(state.cart.length===0){ box.textContent='尚無商品'; return; }
  let sum=0; box.innerHTML = state.cart.map(i=>{ sum+=i.price*i.qty; return `${i.name} × ${i.qty} = NT$ ${(i.price*i.qty).toLocaleString()}`; }).join('<br>');
  box.innerHTML += `<div class="mt-1"><b>小計：NT$ ${sum.toLocaleString()}</b></div>`;
}
function checkout(){
  if(state.cart.length===0) return alert('購物車是空的');
  const sum = state.cart.reduce((a,b)=>a+b.price*b.qty,0);
  state.user.lifetimeSpend = (state.user.lifetimeSpend||0) + sum;
  state.user.vipXp += Math.round(sum/10);
  state.user.energy += Math.round(sum/20);
  state.cart=[]; alert(`結帳成功！累積消費 +$${sum.toLocaleString()}，VIP XP 與能量已增加`);
  save();
}

/* ========== 公會 ========== */
const GUILD_CREATE_NEED = 1200;
function renderGuild(){
  const gname=document.getElementById('guildName'); const glv=document.getElementById('guildLevel'); const gc=document.getElementById('guildContrib');
  if(gname) gname.textContent = state.guild.name||'（尚未創立）';
  if(glv) glv.textContent = state.guild.level||'–';
  if(gc) gc.textContent = state.guild.contribution|0;
}
function createGuild(){
  if((state.user.lifetimeSpend||0) < GUILD_CREATE_NEED){ return alert('尚未達到創立門檻：累積消費 $1,200'); }
  const name = prompt('輸入公會名稱'); if(!name) return;
  state.guild.name=name; state.guild.level=1; save(); alert('公會已創立！');
}
function contribute(n){ if(!state.guild.name) return alert('請先創立/加入公會'); state.guild.contribution += n; if(state.guild.contribution>= (state.guild.level*500)) { state.guild.level++; alert('公會升級！'); } save(); }
function mockWar(){ if(!state.guild.name) return alert('先創立公會'); const add=Math.floor(Math.random()*500+100); const tr=document.createElement('tr'); tr.innerHTML=`<td>*</td><td>${state.guild.name}</td><td>你的區域</td><td>+${add}</td>`; const tbl=document.getElementById('warTable'); if(tbl) tbl.prepend(tr); }

/* ========== 我的貓 + 健檢上傳（Demo） ========== */
async function loadBreeds(){
  try{
    const b = await (await fetch('./data/breeds.json', {cache:'no-cache'})).json();
    const sel = document.getElementById('catBreed'); if(sel){ sel.innerHTML = b.map(x=>`<option>${x}</option>`).join(''); }
  }catch(e){ /* ignore */ }
}
function renderCats(){
  const box = document.getElementById('catList'); const sel = document.getElementById('vetCatSel');
  if(!box||!sel) return;
  if(!state.cats.length){
    box.innerHTML = '<div class="empty">尚未新增主子</div>';
    sel.innerHTML = '<option disabled selected>請先新增主子</option>';
    return;
  }
  box.innerHTML = state.cats.map(c=>`<div class="card" style="padding:14px"><b>${c.name}</b> ｜ ${c.gender==='M'?'公':'母'} ｜ ${c.breed}</div>`).join('');
  sel.innerHTML = state.cats.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
}
function addCat(){
  const name = document.getElementById('catName').value.trim();
  const gender = document.getElementById('catGender').value;
  const breed = document.getElementById('catBreed').value || '未選';
  if(!name) return alert('請輸入主子名稱');
  const id = 'c'+Date.now();
  state.cats.push({id,name,gender,breed});
  save(); renderCats();
  document.getElementById('catName').value='';
}
function ensureGuild(){ if(!state.guild?.name){ alert('請先加入/創立公會，再上傳健檢'); return false; } return true; }
function uploadVet(){
  if(!ensureGuild()) return;
  const sel = document.getElementById('vetCatSel'); const file = document.getElementById('vetFile').files[0];
  if(!sel || !sel.value) return alert('請先新增主子'); if(!file) return alert('請選擇健檢檔案');
  state.guild.contribution = (state.guild.contribution|0) + 10;
  save(); renderGuild();
  document.getElementById('vetNote').textContent = `已替 ${sel.options[sel.selectedIndex].text} 登錄健檢（示範）。公會貢獻 +10`;
  document.getElementById('vetFile').value='';
}

/* ========== 照片牆（本機） ========== */
function addPhoto(e){ const file=e.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>{ state.wall.push(reader.result); save(); }; reader.readAsDataURL(file); }
function renderWall(){ const wall=document.getElementById('wall'); if(!wall) return; wall.innerHTML=''; (state.wall||[]).forEach(src=>{ const img=new Image(); img.src=src; img.style.borderRadius='12px'; wall.appendChild(img); }); }
function clearWall(){ if(confirm('清除所有本機照片？')){ state.wall=[]; save(); }}

/* ========== 地圖 ========== */
async function initMap(){
  const el = document.getElementById('map'); if(!el) return;
  const map=L.map('map').setView([25.0330,121.5654],12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OpenStreetMap'}).addTo(map);
  try{
    const points = await (await fetch('./data/locations.json',{cache:'no-cache'})).json();
    points.forEach(p=>{
      const m=L.marker([p.lat,p.lng]).addTo(map);
      const gLink = `https://www.google.com/maps?q=${p.lat},${p.lng}`;
      const aLink = `https://maps.apple.com/?q=${p.lat},${p.lng}`;
      m.bindPopup(`<b>${p.name}</b><br>${p.address||''}<br><a href='${gLink}' target='_blank'>Google Maps</a> ｜ <a href='${aLink}' target='_blank'>Apple Maps</a>`);
    });
  }catch(e){}
}

/* ========== 聯絡表單（示範） ========== */
function submitForm(e){ e.preventDefault(); alert('已收到您的訊息（示範）'); e.target.reset(); return false; }

/* ========== 啟動 ========== */
window.addEventListener('DOMContentLoaded',()=>{
  loadProducts(); loadBreeds(); renderCats(); initMap(); renderWall();
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
});
</script>
</body>
</html>
