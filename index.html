<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PurrGo 喵來速｜品牌官網 Demo</title>

  <!-- PWA / Icons -->
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./logo/favicon.png">
  <link rel="apple-touch-icon" sizes="192x192" href="./logo/logo-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="./logo/logo-512.png">
  <meta name="theme-color" content="#ff7f50">

  <!-- Styles -->
  <link rel="stylesheet" href="./style.css">

  <!-- Leaflet CSS -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous">
</head>
<body>

<!-- ===== Header ===== -->
<header class="site-header">
  <div class="container nav">
    <a class="brand" href="#home" onclick="scrollToHash('home')">
      <img class="brand-logo" src="./logo/logo-192.png" alt="PurrGo" onerror="this.src='./logo/favicon.png'">
      <span class="brand-name">PurrGo 喵來速</span>
    </a>

    <!-- Hamburger -->
    <button id="menuBtn" class="menu-toggle" aria-label="開啟選單">
      <span class="menu-ico" aria-hidden="true"></span>
    </button>
  </div>

  <!-- Drawer Menu -->
  <nav id="menu" class="menu" aria-label="主選單">
    <a href="#home"      onclick="closeMenu();scrollToHash('home')">首頁</a>
    <a href="#products"  onclick="closeMenu();scrollToHash('products')">產品</a>
    <a href="#guild"     onclick="closeMenu();scrollToHash('guild')">公會</a>
    <a href="#kiosk"     onclick="closeMenu();scrollToHash('kiosk')">據點</a>
    <a href="#community" onclick="closeMenu();scrollToHash('community')">照片牆</a>
    <a href="#social"    onclick="closeMenu();scrollToHash('social')">社群</a>
    <a href="#chat"      onclick="closeMenu();scrollToHash('chat')">聊天</a>
    <a href="#about"     onclick="closeMenu();scrollToHash('about')">理念</a>
    <a href="#contact"   onclick="closeMenu();scrollToHash('contact')">聯絡</a>
  </nav>
  <div id="menuBackdrop" class="menu-backdrop" onclick="closeMenu()"></div>
</header>

<main>

  <!-- ===== Hero ===== -->
  <section id="home" class="page container">
    <div class="hero card">
      <div class="hero-copy">
        <span class="pill">PurrGo 喵來速</span>
        <h1 class="hero-title">便利 × 可愛 × 永續 × 共創</h1>
        <p class="muted">
          創新配送 + 公會制度，讓補給更聰明、更便宜、更好玩。<br>
          把「買貓砂」變成有成就感的里程碑遊戲。
        </p>
        <div class="inline mt-1">
          <a class="btn"           href="#products" onclick="scrollToHash('products')">開始探索產品</a>
          <a class="btn secondary" href="#guild"    onclick="scrollToHash('guild')">加入貓奴公會</a>
          <a class="btn ghost"     href="#about"    onclick="scrollToHash('about')">了解品牌理念</a>
        </div>
      </div>
      <div class="hero-art">
        <div class="hero-visual">
          <img src="./logo/logo-512.png" alt="PurrGo Logo" class="hero-logo"
               onerror="this.src='./logo/logo-192.png'">
        </div>
      </div>
    </div>
  </section>

  <!-- ===== Products ===== -->
  <section id="products" class="page container">
    <header class="section-head">
      <span class="pill">Products</span>
      <h2 class="mt-0">熱銷與方案</h2>
      <p class="section-sub">橫向滑動卡片，支援產品照片、詳情彈窗與加入購物車。</p>
    </header>

    <!-- Horizontal carousel -->
    <div class="hwrap">
      <button class="hbtn prev" aria-label="上一組" onclick="scrollRow('productRow',-1)">‹</button>
      <div id="productRow" class="hscroll"></div>
      <button class="hbtn next" aria-label="下一組" onclick="scrollRow('productRow',1)">›</button>
    </div>

    <div class="card mt-2">
      <h3 class="mt-0">購物車（示範）</h3>
      <div id="cartItems" class="muted">尚無商品</div>
      <div class="inline mt-1">
        <button class="btn" onclick="checkout()">結帳（示範）</button>
        <button class="btn secondary" onclick="clearCart()">清空</button>
      </div>
    </div>
  </section>

  <!-- ===== Guild ===== -->
  <section id="guild" class="page container">
    <header class="section-head">
      <span class="pill">Guild</span>
      <h2 class="mt-0">公會制度：一起成長、一起更省</h2>
      <p class="section-sub">創立門檻、VIP 等級、貢獻條、每日任務…</p>
    </header>

    <div class="grid g-2">
      <div class="card">
        <h3 class="mt-0">身份綁定 / VIP</h3>
        <input class="input" id="phoneInput" placeholder="輸入手機號碼" oninput="bindPhone(this.value)">
        <div id="identityInfo" class="muted mt-1">尚未綁定手機</div>

        <div class="inline mt-1">
          <button class="btn" onclick="toggleLine()" id="lineBtn">綁定 LINE（示意）</button>
          <button class="btn secondary" onclick="dailyCheckin()">每日簽到 + 能量 / XP</button>
        </div>

        <div class="mt-1">
          累積消費：<b id="lifetimeSpend">$0</b> ｜ VIP 等級：<b id="vipLevel">V0</b> ｜ 下一级還差：<b id="vipNext">$0</b>
        </div>
      </div>

      <div class="card">
        <h3 class="mt-0">公會面板</h3>
        <div>名稱：<b id="guildName">（尚未創立）</b> ｜ 等級：<b id="guildLevel">–</b> ｜ 貢獻：<b id="guildContrib">0</b></div>
        <div class="inline mt-1">
          <button class="btn" onclick="createGuild()">創立公會</button>
          <button class="btn secondary" onclick="contribute(50)">捐 50</button>
          <button class="btn secondary" onclick="mockWar()">模擬戰報</button>
        </div>
        <table class="table mt-1">
          <thead><tr><th>敵方</th><th>我方公會</th><th>區域</th><th>貢獻</th></tr></thead>
          <tbody id="warTable"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===== Kiosk / Map ===== -->
  <section id="kiosk" class="page container">
    <header class="section-head">
      <span class="pill">Kiosk</span>
      <h2 class="mt-0">販賣機點位</h2>
      <p class="section-sub">點擊標記可開啟 Google/Apple Maps 導航。</p>
    </header>

    <div id="map" style="height:360px;border-radius:12px;overflow:hidden"></div>
  </section>

  <!-- ===== Community (local demo) ===== -->
  <section id="community" class="page container">
    <header class="section-head">
      <span class="pill">Community</span>
      <h2 class="mt-0">照片牆（本機示範）</h2>
    </header>

    <div class="card">
      <div class="inline">
        <input type="file" accept="image/*" onchange="addPhoto(event)">
        <button class="btn secondary" onclick="clearWall()">清除所有照片（本機）</button>
      </div>
      <div id="wall" class="grid g-3 mt-2"></div>
    </div>
  </section>

  <!-- ===== Social / Chat 區塊預留（Demo 版） ===== -->
  <section id="social" class="page container">
    <header class="section-head"><span class="pill">Social</span><h2 class="mt-0">社群（Demo）</h2></header>
    <div class="card muted">此區為後續擴充預留（貼文、按讚、分享、留言等）。</div>
  </section>

  <section id="chat" class="page container">
    <header class="section-head"><span class="pill">Chat</span><h2 class="mt-0">聊天（Demo）</h2></header>
    <div class="card muted">此區為後續擴充預留（好友、私訊、封鎖、30 秒短影片…）。</div>
  </section>

  <!-- ===== About ===== -->
  <section id="about" class="page container">
    <header class="section-head">
      <span class="pill">About</span>
      <h2 class="mt-0">我們相信「便利 × 可愛 × 永續 × 共創」</h2>
    </header>
    <div class="grid g-4">
      <div class="feature card"><h3 class="mt-0">便利</h3><p class="muted">快速到貨、預購/訂閱、在地販賣機補點。</p></div>
      <div class="feature card"><h3 class="mt-0">可愛</h3><p class="muted">公會化玩法與角色養成，補給更有成就感。</p></div>
      <div class="feature card"><h3 class="mt-0">永續</h3><p class="muted">減少包材、集中配送、鼓勵回收。</p></div>
      <div class="feature card"><h3 class="mt-0">共創</h3><p class="muted">與社群共同研發、投票、同樂。</p></div>
    </div>
  </section>

  <!-- ===== Contact ===== -->
  <section id="contact" class="page container">
    <header class="section-head"><span class="pill">Contact</span><h2 class="mt-0">聯絡我們</h2></header>
    <div class="card">
      <form class="grid g-2" onsubmit="return submitForm(event)">
        <div><label>您的稱呼<input class="input" required></label></div>
        <div><label>Email<input type="email" class="input" required></label></div>
        <div class="gcol-2"><label>訊息<textarea class="input" required></textarea></label></div>
        <div class="inline"><button class="btn" type="submit">送出</button></div>
      </form>
      <p class="muted mt-1">也可來信：<a href="mailto:hello@purrgo.tw">hello@purrgo.tw</a></p>
    </div>
  </section>

</main>

<footer class="container footer muted">
  © PurrGo 喵來速 ｜ 公開 Demo（不含投資人資訊）
</footer>

<!-- FAB -->
<div class="fab" id="fab">
  <button class="fab-btn" data-target="home">Top</button>
  <button class="fab-btn" data-target="products">Shop</button>
  <button class="fab-btn" data-target="guild">Guild</button>
  <button class="fab-btn" data-target="kiosk">Map</button>
  <button class="fab-btn" data-target="contact">Msg</button>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>

<!-- ===== Main Script ===== -->
<script>
/* ---------- State (localStorage) ---------- */
const LS_KEY = 'purrgoState';
const state = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
state.user  ||= { phone:'', line:false, vipXp:0, lifetimeSpend:0, energy:0, lastCheckin:'' };
state.guild ||= { name:'', level:0, contribution:0 };
state.cart  ||= [];
state.vet   ||= [];
state.wall  ||= [];
save();
function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); renderIdentity(); renderVIP(); renderGuild(); renderCart(); renderWall(); }

/* ---------- Header / Menu ---------- */
const $ = s=>document.querySelector(s);
const $$= s=>document.querySelectorAll(s);

function openMenu(){ document.body.classList.add('menu-open'); }
function closeMenu(){ document.body.classList.remove('menu-open'); }

function scrollToHash(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.scrollIntoView({behavior:'smooth',block:'start'});
  setTimeout(highlight, 300);
}

function highlight(){
  const id=(location.hash||'#home').replace('#','');
  $$('.tab').forEach(a=>a.setAttribute('aria-current',a.dataset.sec===id?'page':'false'));
}

window.addEventListener('DOMContentLoaded',()=>{
  $('#menuBtn')?.addEventListener('click',()=>document.body.classList.toggle('menu-open'));
  $('#menuBackdrop')?.addEventListener('click', closeMenu);
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeMenu(); });

  // FAB
  $$('.fab-btn').forEach(b=>{
    b.addEventListener('click',()=>{
      const id=b.dataset.target;
      scrollToHash(id);
    })
  });

  loadProducts();
  initMap();
  renderVet();
  highlight();

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }
});

/* ---------- Identity / VIP ---------- */
function bindPhone(v){ state.user.phone=v||''; save(); }
function toggleLine(){ state.user.line=!state.user.line; save(); }
function renderIdentity(){
  $('#identityInfo').textContent = state.user.phone ? `已綁定：${state.user.phone} ｜ LINE：${state.user.line?'已連結':'未連結'}` : '尚未綁定手機';
  $('#lineBtn').textContent = state.user.line? '取消 LINE 連結（示意）':'綁定 LINE（示意）';
}
function vipLevelByXp(x){ if(x>=5000) return 5; if(x>=3000) return 4; if(x>=1500) return 3; if(x>=600) return 2; if(x>=200) return 1; return 0; }
function nextVipNeed(x){ const br=[200,600,1500,3000,5000]; for(const b of br){ if(x<b) return b-x; } return 0; }
function renderVIP(){
  const xp = state.user.vipXp|0;
  $('#lifetimeSpend').textContent = `$${(state.user.lifetimeSpend||0).toLocaleString()}`;
  $('#vipLevel').textContent = 'V'+vipLevelByXp(xp);
  $('#vipNext').textContent = nextVipNeed(xp)>0? `$${nextVipNeed(xp)}`:'已達頂級';
}
function dailyCheckin(){
  const today = new Date().toISOString().slice(0,10);
  if(state.user.lastCheckin===today){ alert('今天已簽到'); return; }
  state.user.lastCheckin=today; state.user.energy+=10; state.user.vipXp+=10; save();
  alert('簽到成功：+10 能量、+10 VIP XP');
}

/* ---------- Guild ---------- */
const GUILD_CREATE_NEED = 1200;
function renderGuild(){
  $('#guildName').textContent = state.guild.name||'（尚未創立）';
  $('#guildLevel').textContent = state.guild.level||'–';
  $('#guildContrib').textContent = state.guild.contribution|0;
}
function createGuild(){
  if((state.user.lifetimeSpend||0) < GUILD_CREATE_NEED){ return alert('尚未達到創立門檻：累積消費 $1,200'); }
  const name = prompt('輸入公會名稱'); if(!name) return;
  state.guild.name=name; state.guild.level=1; save(); alert('公會已創立！');
}
function contribute(n){ if(!state.guild.name) return alert('請先創立公會'); state.guild.contribution += n; if(state.guild.contribution>= (state.guild.level*500)) { state.guild.level++; alert('公會升級！'); } save(); }
function mockWar(){ if(!state.guild.name) return alert('先創立公會'); const add=Math.floor(Math.random()*500+100); const tr=document.createElement('tr'); tr.innerHTML=`<td>*</td><td>${state.guild.name}</td><td>你的區域</td><td>+${add}</td>`; $('#warTable').prepend(tr); }

/* ---------- Products ---------- */
async function loadProducts(){
  const grid = $('#productRow');
  grid.innerHTML = '<div class="empty">載入中…</div>';
  try{
    const res = await fetch('./data/products.json',{cache:'no-cache'});
    const list = await res.json();
    grid.innerHTML='';
    list.forEach(p=>{
      const el = document.createElement('article'); el.className='pcard';
      el.innerHTML = `
        <div class="pcard-img">${p.img?`<img src="${p.img}" alt="${p.name}">`:'<div class="imgph">No Image</div>'}</div>
        <div class="pcard-body">
          <h3 class="mt-0">${p.name}</h3>
          <div class="muted">${p.spec||''}</div>
          <div class="price">NT$ ${p.price.toLocaleString()}</div>
          <ul class="list">${(p.bullets||[]).map(b=>`<li>${b}</li>`).join('')}</ul>
          <div class="inline mt-1">
            <button class="btn" onclick='addToCart(${JSON.stringify(p).replace(/'/g,"&#39;")})'>加入購物車</button>
            <button class="btn secondary" onclick='openDetail(${JSON.stringify(p).replace(/'/g,"&#39;")})'>查看詳情</button>
          </div>
        </div>`;
      grid.appendChild(el);
    });
  }catch(e){
    grid.innerHTML='<div class="empty">讀取產品失敗</div>';
  }
}
function scrollRow(id,dir){ const el=document.getElementById(id); el.scrollBy({left: dir*320, behavior:'smooth'}); }
function addToCart(p){ const item = state.cart.find(i=>i.id===p.id) || (state.cart.push({...p,qty:0}), state.cart.find(i=>i.id===p.id)); item.qty++; save(); }
function clearCart(){ state.cart=[]; save(); }
function renderCart(){
  const box = $('#cartItems'); if(!box) return;
  if(state.cart.length===0){ box.textContent='尚無商品'; return; }
  let sum=0; box.innerHTML = state.cart.map(i=>{ sum+=i.price*i.qty; return `${i.name} × ${i.qty} = NT$ ${(i.price*i.qty).toLocaleString()}`; }).join('<br>');
  box.innerHTML += `<div class="mt-1"><b>小計：NT$ ${sum.toLocaleString()}</b></div>`;
}
function checkout(){
  if(state.cart.length===0) return alert('購物車是空的');
  const sum = state.cart.reduce((a,b)=>a+b.price*b.qty,0);
  state.user.lifetimeSpend = (state.user.lifetimeSpend||0) + sum;
  state.user.vipXp += Math.round(sum/10);
  state.user.energy += Math.round(sum/20);
  state.cart=[]; alert(`結帳成功！累積消費 +$${sum.toLocaleString()}，VIP XP 與能量已增加`);
  save();
}

/* 詳情 Modal */
function openDetail(p){
  const wrap = document.createElement('div');
  wrap.className='modal-backdrop';
  wrap.innerHTML = `
  <div class="modal">
    <button class="modal-close" aria-label="關閉" onclick="this.closest('.modal-backdrop').remove()">×</button>
    <div class="modal-body">
      <div class="modal-img">${p.img?`<img src="${p.img}" alt="${p.name}">`:'<div class="imgph">No Image</div>'}</div>
      <div class="modal-copy">
        <h3 class="mt-0">${p.name}</h3>
        <div class="muted">${p.spec||''}</div>
        <div class="price">NT$ ${p.price.toLocaleString()}</div>
        <ul class="list">${(p.bullets||[]).map(b=>`<li>${b}</li>`).join('')}</ul>
      </div>
    </div>
  </div>`;
  document.body.appendChild(wrap);
}

/* ---------- Photos (local) ---------- */
function addPhoto(e){ const file=e.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>{ state.wall.push(reader.result); save(); }; reader.readAsDataURL(file); }
function renderWall(){ const wall=$('#wall'); if(!wall) return; wall.innerHTML=''; (state.wall||[]).forEach(src=>{ const img=new Image(); img.src=src; img.style.borderRadius='12px'; wall.appendChild(img); }); }
function clearWall(){ if(confirm('清除所有本機照片？')){ state.wall=[]; save(); }}

/* ---------- Map (Leaflet) ---------- */
async function initMap(){
  const map=L.map('map').setView([25.0330,121.5654],12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OpenStreetMap'}).addTo(map);
  try{
    const res = await fetch('./data/locations.json',{cache:'no-cache'}); const points = await res.json();
    points.forEach(p=>{
      const m=L.marker([p.lat,p.lng]).addTo(map);
      const gLink = `https://www.google.com/maps?q=${p.lat},${p.lng}`;
      const aLink = `https://maps.apple.com/?q=${p.lat},${p.lng}`;
      m.bindPopup(`<b>${p.name}</b><br>${p.address||''}<br><a href='${gLink}' target='_blank'>Google Maps</a> ｜ <a href='${aLink}' target='_blank'>Apple Maps</a>`);
    });
  }catch(e){}
}

/* ---------- Contact ---------- */
function submitForm(e){ e.preventDefault(); alert('已收到您的訊息（示範）'); e.target.reset(); return false; }
</script>
</body>
</html>
